<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>ASP.NET WEB API | Welcome To LifeTech's Blog</title><meta name="keywords" content="csharp相关学习"><meta name="author" content="Jackey Zhou"><meta name="copyright" content="Jackey Zhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="ASP.NET WEB API"><meta name="application-name" content="ASP.NET WEB API"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="ASP.NET WEB API"><meta property="og:url" content="http://example.com/2025/05/12/ASP-NET-WEB-API/index.html"><meta property="og:site_name" content="Welcome To LifeTech's Blog"><meta property="og:description" content="目录 ASP.NET Core Web API Learning Directory1. ASP.NET Core Web API 简介 1.1. 什么是 ASP.NET Core? 1.2. 什么是 Web API? 1.3. RESTful API 设计原则 1.4. 为什么选择 ASP.NET"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="Jackey Zhou"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="目录 ASP.NET Core Web API Learning Directory1. ASP.NET Core Web API 简介 1.1. 什么是 ASP.NET Core? 1.2. 什么是 Web API? 1.3. RESTful API 设计原则 1.4. 为什么选择 ASP.NET"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/05/12/ASP-NET-WEB-API/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Jackey Zhou","link":"链接: ","source":"来源: Welcome To LifeTech's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Welcome To LifeTech's Blog',
  title: 'ASP.NET WEB API',
  postAI: '',
  pageFillDescription: 'ASP.NET Core Web API Learning Directory, , , , , , , , , , , , , , , , , , , 1. ASP.NET Core Web API 简介, 1.1. 什么是 ASP.NET Core?, 1.2. 什么是 Web API?, 1.3. RESTful API 设计原则, 1.4. 为什么选择 ASP.NET Core Web API?, 2. 环境搭建与第一个 API, 2.1. 先决条件, 2.2. 创建新项目 (CLI 与 Visual Studio), 使用 .NET CLI, 使用 Visual Studio, 2.3. 项目结构概览 (基于控制器的模板), 2.4. Program.cs - 应用的起点, 2.5. 运行与测试你的第一个 API, 3. 控制器 (Controllers) vs. 最小 API (Minimal APIs), 3.1. 基于控制器的 API, 3.2. 最小 API, 3.3. 如何选择?, 4. 路由 (Routing), 4.1. 路由基础, 4.2. 基于属性的路由 (Controllers), 4.3. 路由在最小 API 中的实现, 4.4. 路由参数与约束, 4.5. 路由命名与链接生成, 5. HTTP 动词与操作方法 (Actions), 5.1. 理解 HTTP 动词 (GET POST PUT DELETE PATCH 等), 5.2. 在控制器中映射动词, 5.3. 在最小 API 中映射动词, 6. 数据处理：模型绑定、验证与响应, 6.1. 模型绑定 (Model Binding), 绑定源 ([FromRoute] [FromQuery] [FromBody] [FromHeader] [FromForm]), 6.2. 数据验证 (Data Validation), 数据注解 (Data Annotations), FluentValidation (第三方库), ModelState 与自动 HTTP 400 响应, 6.3. 返回响应 (Responses), HTTP 状态码, IActionResult 与 ActionResultltTgt, 最小 API 中的 Results 类型, 6.4. 内容协商 (Content Negotiation - 简介), 6.5. 输入与输出格式化器 (Formatters), 7. 依赖注入 (Dependency Injection - DI), 7.1. DI 核心概念, 7.2. 服务生命周期 (Singleton Scoped Transient), 7.3. 注册服务 (Program.cs), 7.4. 注入服务 (构造函数注入 操作方法注入), 8. 配置 (Configuration), 8.1. appsettings.json 与环境特定配置, 8.2. 读取配置数据 (IConfiguration), 8.3. 选项模式 (Options Pattern), 9. 中间件 (Middleware), 9.1. 什么是中间件?, 9.2. 请求处理管道 (Request Pipeline), 9.3. 内置中间件示例, 9.4. 编写自定义中间件, 10. 错误处理与日志记录, 10.1. 开发环境异常页面, 10.2. 生产环境异常处理中间件 (UseExceptionHandler), 10.3. ProblemDetails 规范, 10.4. 日志记录 (ILogger), 11. 安全性 (Security), 11.1. HTTPS, 11.2. 认证 (Authentication), JWT (JSON Web Tokens), Cookie 认证 (适用于 Web 应用API 中较少), 11.2.3 ASP.NET Core Identity, 11.3. 授权 (Authorization), [Authorize] 特性, 基于角色的授权 (Role-based), 基于策略的授权 (Policy-based), 11.4. CORS (Cross-Origin Resource Sharing), 11.5. 防止常见 Web 漏洞 (XSS CSRF - API 相关性), 11.6. API 密钥管理, 12. API 版本控制 (Versioning), 12.1. 为什么需要 API 版本控制?, 12.2. 常见版本控制策略, 12.3. 使用 Asp.Versioning 库, 13. API 文档 (Swaggerx2FOpenAPI), 13.1. OpenAPI 规范, 13.2. 使用 Swashbuckle.AspNetCore, 13.3. 使用 NSwag (备选方案), 14. 测试 Web API, 14.1. 单元测试, 14.2. 集成测试 (WebApplicationFactory), 15. 高级主题, 15.1. 过滤器 (Filters), 15.2. 速率限制 (Rate Limiting), 15.3. 缓存 (Caching), 15.4. 后台任务与托管服务 (IHostedService), 15.5. 健康检查 (Health Checks), 15.6. gRPC (作为 REST API 的替代或补充), 16. 部署 ASP.NET Core Web API, 16.1. 发布应用, 16.2. 托管模型 (进程内 vs. 进程外 - 主要针对 IIS), 16.3. 常见托管环境 (IIS Kestrel Nginxx2FApache 反向代理 Docker Azure App Service AWS 等), 17. 最佳实践, 18. 总结与未来展望目录简介什么是什么是设计原则为什么选择环境搭建与第一个先决条件创建新项目与项目结构概览应用的起点运行与测试你的第一个控制器最小基于控制器的最小如何选择路由路由基础基于属性的路由路由在最小中的实现路由参数与约束路由命名与链接生成动词与操作方法理解动词等在控制器中映射动词在最小中映射动词数据处理模型绑定验证与响应模型绑定绑定源数据验证数据注解第三方库与自动响应返回响应状态码与最小中的类型内容协商简介输入与输出格式化器依赖注入核心概念服务生命周期注册服务注入服务构造函数注入操作方法注入配置与环境特定配置读取配置数据选项模式中间件什么是中间件请求处理管道内置中间件示例编写自定义中间件错误处理与日志记录开发环境异常页面生产环境异常处理中间件规范日志记录安全性认证认证适用于应用中较少授权特性基于角色的授权基于策略的授权防止常见漏洞相关性密钥管理版本控制为什么需要版本控制常见版本控制策略使用库文档规范使用使用备选方案测试单元测试集成测试高级主题过滤器速率限制缓存后台任务与托管服务健康检查作为的替代或补充部署发布应用托管模型进程内进程外主要针对常见托管环境反向代理等最佳实践总结与未来展望简介什么是是一个现代化开源跨平台的框架用于构建基于云的联网的应用程序如应用应用和移动后端它由微软和社区共同开发是的下一代演进版本具有更高的性能模块化设计和灵活性什么是应用程序编程接口是一种允许不同软件应用程序通过网络通常是协议进行通信的接口它定义了一组规则和协议使得客户端如浏览器移动应用或其他服务可以请求数据或执行操作而无需了解服务端的内部实现是使用构建服务的框架这些服务可以被广泛的客户端访问设计原则是一种用于设计网络应用程序的架构风格符合原则的通常称为主要原则包括客户端服务器清晰分离关注点无状态服务器不应在请求之间存储任何客户端状态每个请求都应包含处理它所需的所有信息可缓存响应应可被客户端或中间层缓存以提高性能统一接口资源标识通过统一资源标识符标识资源通过表述修改资源客户端通过操作资源的表述如来修改服务器上的资源自描述消息请求和响应应包含足够的信息以自我描述如方法媒体类型超媒体作为应用状态的引擎响应中应包含链接引导客户端发现其他可用资源和操作分层系统客户端通常不知道它是否直接连接到最终服务器还是连接到中间层按需代码可选服务器可以通过脚本或小程序临时扩展客户端功能为什么选择高性能是目前性能最高的框架之一跨平台可以在和上开发和部署现代化支持最新的标准和开发实践如依赖注入异步编程中间件架构灵活性可以选择使用控制器或更轻量级的最小来构建服务与生态系统集成无缝利用包等强大的工具支持提供了出色的开发体验开源与社区驱动拥有活跃的社区和持续的改进环境搭建与第一个先决条件安装最新版本的推荐或可以从下载代码编辑器或更高版本配合扩展创建新项目与使用创建一个使用控制器的项目或者创建一个最小项目默认标志会创建一个包含示例的项目如果不加此标志在中默认创建的是最小项目使用打开选择创建新项目搜索并选择模板配置项目名称位置选择目标框架或在其他信息页面可以选择是否使用控制器取消勾选以使用最小建议初学者从勾选使用控制器开始或直接体验最小确保为配置启用已勾选项目结构概览基于控制器的模板存放控制器类启动配置应用配置文件开发环境特定配置项目文件应用入口点和配置示例模型类文件夹如果创建应用或添加静态文件支持存放静态文件图像对于纯此文件夹可能不存在或为空应用的起点在及更高版本中采用了新的顶级语句格式更加简洁示例风格添加服务到容器如果使用控制器推荐的错误处理学习相关知识用于浏览器和配置生成器配置请求处理管道启用中间件启用开发环境异常页面生产环境异常处理强制生产将请求重定向到如果需要提供静态文件启用路由中间件启用认证中间件如果配置了认证启用授权中间件映射控制器路由如果使用控制器或者定义最小端点启动应用初始化一个新的实例用于注册依赖注入服务构建实例隐式用于配置请求处理管道中的中间件运行与测试你的第一个点击启动按钮通常是绿色三角可以选择或应用启动后通常会自动打开浏览器并导航到页面例如你可以在上查看文档并直接发送请求进行测试也可以使用或等工具测试端点控制器最小提供了两种主要方式来构建端点基于控制器的类继承自或如果需要视图支持但通常用通常用特性标记该特性会启用一些有用的约定行为如自动模型验证并返回错误推断绑定源等操作方法是类中的公共方法通常用动词特性等和路由特性标记优点结构清晰易于组织大型非常适合传统的模式面向对象特性如过滤器依赖注入集成良好缺点对于简单的可能会显得有些冗余需要创建类方法特性等路由模板方法最小引入并在后续版本中不断增强允许直接在或其他地方使用表达式或方法来定义端点无需控制器的样板代码优点代码简洁启动速度快非常适合微服务或小型简单的易于上手缺点对于大型复杂的组织和维护所有端点在单个文件中可能变得困难尽管可以将它们组织到不同的文件中或使用路由组某些高级控制器特性如模型绑定器的细粒度控制复杂的过滤器管道可能需要更多手动配置或通过扩展方法组织到其他文件如何选择简单快速微服务最小通常是更好的选择大型复杂企业级应用需要清晰结构和组织基于控制器的可能更合适团队熟悉度如果团队熟悉模式控制器可能更容易过渡两者可以混合使用在同一个项目中路由路由是将传入的请求映射到特定处理程序控制器操作或最小委托的机制路由基础路由系统解析请求的路径并根据配置的路由模板和约束来确定哪个代码应该处理该请求基于属性的路由这是构建时最常用的路由方式特性可以应用于控制器类或操作方法控制器级别令牌会被替换为控制器名称不含后缀操作方法级别可以定义相对于控制器路由的子路由或覆盖控制器路由动词特性也可包含路由模板路由在最小中的实现使用扩展方法直接在实例上定义路由和处理程序路由组用于路由参数与约束路由参数在路由模板中用定义如参数值会绑定到操作方法的参数路由约束限制路由参数可以接受的值类型或格式必须是整数必须是字母其他约束长度为的字母路由命名与链接生成可以为路由命名以便在代码中生成指向这些路由的链接例如在创建资源后返回响应头控制器最小链接生成使用服务或在控制器中在最小中动词与操作方法理解动词等动词也称方法定义了对资源执行的操作请求获取指定资源的表示安全且幂等向服务器提交数据以创建新资源或执行其他非幂等操作用请求中的数据替换目标资源的全部当前内容幂等删除指定的资源幂等对资源应用部分修改通常非幂等但也可以设计成幂等类似但只返回响应头不返回响应体安全且幂等获取目标资源支持的通信选项如允许的方法安全且幂等在控制器中映射动词使用动词特性在最小中映射动词使用的扩展方法对于等可以用数据处理模型绑定验证与响应模型绑定模型绑定是将传入请求中的数据如来自路由查询字符串请求体转换为操作方法参数的过程会自动尝试从不同来源绑定数据绑定源可以通过这些特性显式指定参数的绑定来源从路由数据中获取值从查询字符串中获取值从请求头中获取值从请求体中获取值通常用于或数据一个操作方法通常最多只能有一个参数从请求的表单数据中获取值推断会尝试推断绑定源复杂类型通常假定为简单类型按顺序尝试路由查询字符串等最小也有类似的推断逻辑数据验证确保传入的数据符合预期格式和约束数据注解在模型类的属性上使用中的特性常用注解第三方库一个流行的库提供更灵活更强大的链式来定义验证规则并将验证逻辑与模型类分离与自动响应对于标记了的控制器如果模型绑定或验证失败会自动用包含错误详情的响应返回在操作方法内部可以检查属性最小默认不自动执行此操作但可以通过过滤器或手动检查来实现在中如果参数是或使用了数据注解最小也会进行验证但行为可能需要通过定制返回响应状态码使用适当的状态码来指示请求的结果成功请求成功资源创建成功通常后返回并在头中包含新资源的请求成功但没有内容返回通常或成功后返回重定向较少直接用于客户端错误请求无效如格式错误验证失败未经身份验证已认证但无权访问该资源未找到请求的资源请求的方法不被允许请求冲突如尝试创建已存在的资源请求格式正确但由于语义错误无法处理服务器错误服务器内部发生意外错误与在控制器中操作方法通常返回这些类型以便对响应有更多控制一个通用接口表示操作方法的结果有很多内置实现返回指定状态码结合了的灵活性和返回特定类型的能力如果返回的实例则框架假定为返回隐式返回最小中的类型最小使用静态类中的方法来创建响应假设有这个方法假设有名为的路由命名路由内容协商简介客户端可以通过请求头指定其期望的响应格式如服务器根据其能力和客户端的偏好选择合适的格式默认支持可以通过配置添加对等其他格式的支持输入与输出格式化器格式化器负责将请求体反序列化为对象以及将对象序列化为响应体默认使用进行序列化反序列化可以通过添加对的支持可以创建自定义格式化器依赖注入核心概念依赖注入是一种设计模式其中一个对象客户端的依赖项服务由外部实体容器提供而不是由对象自己创建这促进了松耦合和可测试性服务生命周期的容器支持三种主要的服务生命周期在应用程序的整个生命周期中只创建一个实例所有请求共享同一个实例在每个客户端请求作用域内创建一个实例在同一请求中多次请求该服务会得到同一个实例每次请求服务时都会创建一个新实例注册服务在中使用的扩展方法注册服务注入服务构造函数注入操作方法注入构造函数注入推荐服务通过类的构造函数注入构造函数注入操作方法注入服务直接注入到控制器操作方法或最小处理程序的参数中通常用于仅在特定操作中需要的服务配置与环境特定配置使用分层的配置系统默认配置源包括基础配置如根据当前环境覆盖基础配置环境变量命令行参数读取配置数据服务已默认注册可以注入到类中以访问配置值或者或者选项模式一种将相关配置设置组合到强类型类中的模式定义选项类在中配置注入和使用获取实例用于作用域生命周期用于响应配置更改中间件什么是中间件中间件是组装到应用程序管道中以处理请求和响应的软件组件每个组件选择是否将请求传递给管道中的下一个组件可以在调用下一个组件之前和之后执行工作请求处理管道中的请求处理管道由一系列中间件组件构成每个传入的请求都会依次通过这些中间件每个中间件都可以检查修改请求或响应或短路管道中间件的顺序非常重要图片来源内置中间件示例在中通过方法添加将重定向到提供静态文件服务向管道添加路由匹配配置跨域资源共享启用身份验证启用授权捕获未处理的异常等将请求分派到端点编写自定义中间件可以通过约定或实现接口来创建约定方式使用在调用下一个中间件之前执行操作调用管道中的下一个中间件在调用下一个中间件之后执行操作接口方式更适合需要依赖注入的中间件错误处理与日志记录开发环境异常页面通常在提供详细的异常信息方便开发时调试生产环境异常处理中间件将用户重定向到错误处理路径或自定义处理逻辑这会捕获后续中间件中未处理的异常并生成错误响应规范定义了一种标准的机器可读的错误详情格式引入了和需要来简化生成响应控制器在模型验证失败时会自动返回格式的响应日志记录内置了日志记录系统支持多种日志提供程序控制台等也可以集成第三方日志框架注入日志级别配置在中安全性始终在生产环境中使用来加密通信和有助于强制认证验证请求者的身份一种流行的无状态认证机制客户端在登录后获取并在后续请求的头中携带它配置认证适用于应用中较少主要用于传统的应用程序状态通过维护对于无状态更常见一个完整的成员资格系统包括用户管理密码哈希双因素认证等可以与或认证结合使用授权确定经过身份验证的用户是否有权执行请求的操作或访问资源特性应用于控制器操作方法或最小端点要求用户必须经过身份验证基于角色的授权要求用户属于指定的角色之一基于策略的授权提供更灵活更细粒度的授权控制策略在中定义自定义和浏览器安全机制阻止网页向不同源域协议端口的服务器发出某些类型的请求如果你的需要被不同源的应用调用则需要配置必须在和之间防止常见漏洞相关性主要返回数据如风险更多地在消费的前端应用中确保不会意外地返回可执行脚本或主要影响基于认证的应用对于使用如认证的无状态风险较低但仍需注意的使用场景输入验证始终验证所有输入数据参数化查询防止注入如果直接操作数据库密钥管理对于需要服务器到服务器通信或第三方应用访问的通常使用密钥进行简单的认证密钥应保密并通过安全的头如传递版本控制为什么需要版本控制当需要进行重大不向后兼容的更改时版本控制允许你引入这些更改而不会破坏现有客户端的集成常见版本控制策略路径版本控制最常见查询字符串版本控制版本控制使用自定义请求头如或头如使用库以前是和用于集成是流行的库在响应头中报告支持的版本和废弃的版本将特定操作映射到特定版本文档规范规范前身为规范是一种用于描述生成消费和可视化服务的与语言无关的接口规范使用一个流行的库用于根据你的控制器和模型自动生成文档并提供安装配置为认证添加安全定义可选可选包含注释如果想在根路径访问要包含注释需要在项目文件中启用使用备选方案是另一个功能强大的工具集支持代码生成客户端和服务端等测试单元测试测试单个类或方法如控制器操作服务的逻辑隔离其依赖项使用模拟等集成测试测试多个组件的交互包括请求管道中间件模型绑定过滤器控制器和依赖注入的服务用于在内存中托管应用并发送请求进行测试示例是入口点类创建假设这是你的一个端点高级主题过滤器允许在请求处理管道的特定阶段之前或之后运行代码用于横切关注点如日志记录异常处理授权缓存类型可以作为特性应用于控制器或操作方法或全局注册最小使用速率限制限制客户端在给定时间窗口内可以发出的请求数量以防止滥用引入了内置的速率限制中间件缓存响应缓存控制响应的缓存行为头等内存缓存在服务器内存中缓存数据分布式缓存如用于多服务器环境后台任务与托管服务使用和实现长时间运行的后台任务这些任务与应用程序的生命周期一起启动和停止健康检查提供一个端点如报告应用程序及其依赖项数据库外部服务的健康状况作为的替代或补充是一个高性能开源的通用框架使用与相比它通常提供更好的性能和更强的类型协定特别适用于内部微服务通信对有良好支持部署发布应用使用命令或的发布功能这将编译应用并将所有必要的文件包括依赖项和运行时如果发布为自包含应用复制到输出目录托管模型进程内进程外主要针对进程内应用直接在工作进程或内部运行性能通常更好这是的默认模型进程外应用在服务器上独立运行作为反向代理将请求转发给常见托管环境反向代理等跨平台的默认服务器快速且轻量通常与反向代理如结合使用以获得边缘服务器功能负载均衡终止静态内容服务可以作为反向代理或直接托管进程内需要常作为的反向代理将应用容器化便于部署和扩展云平台最佳实践遵循原则使用正确的动词基于资源设计使用始终保护传输中的数据版本化为重大更改引入新版本提供清晰的文档实现健壮的错误处理返回有意义的错误信息和状态码验证所有输入不要信任客户端数据使用异步编程避免阻塞线程提高可伸缩性保持控制器处理程序简洁将业务逻辑移到服务层编写可测试的代码利用编写单元测试和集成测试有效利用缓存减少对后端资源的请求实施日志记录和监控考虑安全性认证授权防止常见漏洞无状态设计端点应尽可能无状态总结与未来展望是一个强大高性能且灵活的框架用于构建现代服务无论是选择传统的基于控制器的模式还是更简洁的最小它都提供了构建健壮可伸缩和安全所需的全部工具随着生态系统的不断发展例如和中对性能编译集成等方面的持续投入将继续是构建各种服务和微服务的首选技术之一',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-12 02:29:07',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Welcome To LifeTech's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CSharp%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">CSharp学习<sup>3</sup></a><a href="/tags/IDE%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 1.05rem;">IDE常用快捷键<sup>2</sup></a><a href="/tags/Rust%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">Rust基础知识<sup>21</sup></a><a href="/tags/csharp%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">csharp相关学习<sup>5</sup></a><a href="/tags/docker%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">docker学习<sup>1</sup></a><a href="/tags/hexo%E5%8D%9A%E5%AE%A2%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4/" style="font-size: 1.05rem;">hexo博客常见命令<sup>1</sup></a><a href="/tags/python%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">python相关学习<sup>4</sup></a><a href="/tags/xmake%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">xmake学习<sup>3</sup></a><a href="/tags/%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">个人学习<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" style="font-size: 1.05rem;">数据分析<sup>1</sup></a><a href="/tags/%E6%97%A0%E7%BA%BF%E8%B0%83%E8%AF%95/" style="font-size: 1.05rem;">无线调试<sup>1</sup></a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">深度学习<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" style="font-size: 1.05rem;">系统常用命令<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 1.05rem;">系统常用快捷键<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">30</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/csharp%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>csharp相关学习</span></a></span></div></div><h1 class="post-title" itemprop="name headline">ASP.NET WEB API</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-05-11T18:16:40.000Z" title="发表于 2025-05-12 02:16:40">2025-05-12</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-05-11T18:29:07.753Z" title="更新于 2025-05-12 02:29:07">2025-05-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为无锡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>无锡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/05/12/ASP-NET-WEB-API/"><header><a href="/tags/csharp%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" tabindex="-1" itemprop="url">csharp相关学习</a><h1 id="CrawlerTitle" itemprop="name headline">ASP.NET WEB API</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Jackey Zhou</span><time itemprop="dateCreated datePublished" datetime="2025-05-11T18:16:40.000Z" title="发表于 2025-05-12 02:16:40">2025-05-12</time><time itemprop="dateCreated datePublished" datetime="2025-05-11T18:29:07.753Z" title="更新于 2025-05-12 02:29:07">2025-05-12</time></header><p><strong>目录</strong></p>
<h1 id="ASP-NET-Core-Web-API-Learning-Directory"><a href="#ASP-NET-Core-Web-API-Learning-Directory" class="headerlink" title="ASP.NET Core Web API Learning Directory"></a>ASP.NET Core Web API Learning Directory</h1><h2 id="1-ASP-NET-Core-Web-API-简介"><a href="#1-ASP-NET-Core-Web-API-简介" class="headerlink" title="1. ASP.NET Core Web API 简介"></a><a href="#1-aspnet-core-web-api-%E7%AE%80%E4%BB%8B">1. ASP.NET Core Web API 简介</a></h2><ul>
<li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AF-aspnet-core">1.1. 什么是 ASP.NET Core?</a></li>
<li><a href="#12-%E4%BB%80%E4%B9%88%E6%98%AF-web-api">1.2. 什么是 Web API?</a></li>
<li><a href="#13-restful-api-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">1.3. RESTful API 设计原则</a></li>
<li><a href="#14-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-aspnet-core-web-api">1.4. 为什么选择 ASP.NET Core Web API?</a></li>
</ul>
<h2 id="2-环境搭建与第一个-API"><a href="#2-环境搭建与第一个-API" class="headerlink" title="2. 环境搭建与第一个 API"></a><a href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%AC%AC%E4%B8%80%E4%B8%AA-api">2. 环境搭建与第一个 API</a></h2><ul>
<li><a href="#21-%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6">2.1. 先决条件</a></li>
<li><a href="#22-%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE-cli-%E4%B8%8E-visual-studio">2.2. 创建新项目 (CLI 与 Visual Studio)</a></li>
<li><a href="#23-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%A7%88">2.3. 项目结构概览</a></li>
<li><a href="#24-programcs---%E5%BA%94%E7%94%A8%E7%9A%84%E8%B5%B7%E7%82%B9">2.4. <code>Program.cs</code> - 应用的起点</a></li>
<li><a href="#25-%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-api">2.5. 运行与测试你的第一个 API</a></li>
</ul>
<h2 id="3-控制器-Controllers-vs-最小-API-Minimal-APIs"><a href="#3-控制器-Controllers-vs-最小-API-Minimal-APIs" class="headerlink" title="3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)"></a><a href="#3-%E6%8E%A7%E5%88%B6%E5%99%A8-controllers-vs-%E6%9C%80%E5%B0%8F-api-minimal-apis">3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)</a></h2><ul>
<li><a href="#31-%E5%9F%BA%E4%BA%8E%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84-api">3.1. 基于控制器的 API</a></li>
<li><a href="#32-%E6%9C%80%E5%B0%8F-api">3.2. 最小 API</a></li>
<li><a href="#33-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9">3.3. 如何选择?</a></li>
</ul>
<h2 id="4-路由-Routing"><a href="#4-路由-Routing" class="headerlink" title="4. 路由 (Routing)"></a><a href="#4-%E8%B7%AF%E7%94%B1-routing">4. 路由 (Routing)</a></h2><ul>
<li><a href="#41-%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80">4.1. 路由基础</a></li>
<li><a href="#42-%E5%9F%BA%E4%BA%8E%E5%B1%9E%E6%80%A7%E7%9A%84%E8%B7%AF%E7%94%B1-controllers">4.2. 基于属性的路由 (Controllers)</a></li>
<li><a href="#43-%E8%B7%AF%E7%94%B1%E5%9C%A8%E6%9C%80%E5%B0%8F-api-%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0">4.3. 路由在最小 API 中的实现</a></li>
<li><a href="#44-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E4%B8%8E%E7%BA%A6%E6%9D%9F">4.4. 路由参数与约束</a></li>
<li><a href="#45-%E8%B7%AF%E7%94%B1%E5%91%BD%E5%90%8D%E4%B8%8E%E9%93%BE%E6%8E%A5%E7%94%9F%E6%88%90">4.5. 路由命名与链接生成</a></li>
</ul>
<h2 id="5-HTTP-动词与操作方法-Actions"><a href="#5-HTTP-动词与操作方法-Actions" class="headerlink" title="5. HTTP 动词与操作方法 (Actions)"></a><a href="#5-http-%E5%8A%A8%E8%AF%8D%E4%B8%8E%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95-actions">5. HTTP 动词与操作方法 (Actions)</a></h2><ul>
<li><a href="#51-%E7%90%86%E8%A7%A3-http-%E5%8A%A8%E8%AF%8D-get-post-put-delete-patch-%E7%AD%89">5.1. 理解 HTTP 动词 (GET, POST, PUT, DELETE, PATCH 等)</a></li>
<li><a href="#52-%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%AD%E6%98%A0%E5%B0%84%E5%8A%A8%E8%AF%8D">5.2. 在控制器中映射动词</a></li>
<li><a href="#53-%E5%9C%A8%E6%9C%80%E5%B0%8F-api-%E4%B8%AD%E6%98%A0%E5%B0%84%E5%8A%A8%E8%AF%8D">5.3. 在最小 API 中映射动词</a></li>
</ul>
<h2 id="6-数据处理：模型绑定、验证与响应"><a href="#6-数据处理：模型绑定、验证与响应" class="headerlink" title="6. 数据处理：模型绑定、验证与响应"></a><a href="#6-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%93%8D%E5%BA%94">6. 数据处理：模型绑定、验证与响应</a></h2><ul>
<li><a href="#61-%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A-model-binding">6.1. 模型绑定 (Model Binding)</a><ul>
<li><a href="#%E7%BB%91%E5%AE%9A%E6%BA%90-fromroute-fromquery-frombody-fromheader-fromform">绑定源 (<code>[FromRoute]</code>, <code>[FromQuery]</code>, <code>[FromBody]</code>, <code>[FromHeader]</code>, <code>[FromForm]</code>)</a></li>
</ul>
</li>
<li><a href="#62-%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81-data-validation">6.2. 数据验证 (Data Validation)</a><ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%B3%A8%E8%A7%A3-data-annotations">数据注解 (Data Annotations)</a></li>
<li><a href="#fluentvalidation-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93">FluentValidation (第三方库)</a></li>
<li><a href="#modelstate-%E4%B8%8E%E8%87%AA%E5%8A%A8-http-400-%E5%93%8D%E5%BA%94"><code>ModelState</code> 与自动 HTTP 400 响应</a></li>
</ul>
</li>
<li><a href="#63-%E8%BF%94%E5%9B%9E%E5%93%8D%E5%BA%94-responses">6.3. 返回响应 (Responses)</a><ul>
<li><a href="#http-%E7%8A%B6%E6%80%81%E7%A0%81">HTTP 状态码</a></li>
<li><a href="#iactionresult-%E4%B8%8E-actionresultt"><code>IActionResult</code> 与 <code>ActionResult&lt;T&gt;</code></a></li>
<li><a href="#%E6%9C%80%E5%B0%8F-api-%E4%B8%AD%E7%9A%84-results-%E7%B1%BB%E5%9E%8B">最小 API 中的 <code>Results</code> 类型</a></li>
</ul>
</li>
<li><a href="#64-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86-content-negotiation---%E7%AE%80%E4%BB%8B">6.4. 内容协商 (Content Negotiation - 简介)</a></li>
<li><a href="#65-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%99%A8-formatters">6.5. 输入与输出格式化器 (Formatters)</a></li>
</ul>
<h2 id="7-依赖注入-Dependency-Injection-DI"><a href="#7-依赖注入-Dependency-Injection-DI" class="headerlink" title="7. 依赖注入 (Dependency Injection - DI)"></a><a href="#7-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-dependency-injection---di">7. 依赖注入 (Dependency Injection - DI)</a></h2><ul>
<li><a href="#71-di-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">7.1. DI 核心概念</a></li>
<li><a href="#72-%E6%9C%8D%E5%8A%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-singleton-scoped-transient">7.2. 服务生命周期 (Singleton, Scoped, Transient)</a></li>
<li><a href="#73-%E6%B3%A8%E5%86%8C%E6%9C%8D%E5%8A%A1-programcs">7.3. 注册服务 (<code>Program.cs</code>)</a></li>
<li><a href="#74-%E6%B3%A8%E5%85%A5%E6%9C%8D%E5%8A%A1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5">7.4. 注入服务 (构造函数注入, 操作方法注入)</a></li>
</ul>
<h2 id="8-配置-Configuration"><a href="#8-配置-Configuration" class="headerlink" title="8. 配置 (Configuration)"></a><a href="#8-%E9%85%8D%E7%BD%AE-configuration">8. 配置 (Configuration)</a></h2><ul>
<li><a href="#81-appsettingsjson-%E4%B8%8E%E7%8E%AF%E5%A2%83%E7%89%B9%E5%AE%9A%E9%85%8D%E7%BD%AE">8.1. <code>appsettings.json</code> 与环境特定配置</a></li>
<li><a href="#82-%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE-iconfiguration">8.2. 读取配置数据 (<code>IConfiguration</code>)</a></li>
<li><a href="#83-%E9%80%89%E9%A1%B9%E6%A8%A1%E5%BC%8F-options-pattern">8.3. 选项模式 (Options Pattern)</a></li>
</ul>
<h2 id="9-中间件-Middleware"><a href="#9-中间件-Middleware" class="headerlink" title="9. 中间件 (Middleware)"></a><a href="#9-%E4%B8%AD%E9%97%B4%E4%BB%B6-middleware">9. 中间件 (Middleware)</a></h2><ul>
<li><a href="#91-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%AD%E9%97%B4%E4%BB%B6">9.1. 什么是中间件?</a></li>
<li><a href="#92-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E7%AE%A1%E9%81%93-request-pipeline">9.2. 请求处理管道 (Request Pipeline)</a></li>
<li><a href="#93-%E5%86%85%E7%BD%AE%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%A4%BA%E4%BE%8B">9.3. 内置中间件示例</a></li>
<li><a href="#94-%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6">9.4. 编写自定义中间件</a></li>
</ul>
<h2 id="10-错误处理与日志记录"><a href="#10-错误处理与日志记录" class="headerlink" title="10. 错误处理与日志记录"></a><a href="#10-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">10. 错误处理与日志记录</a></h2><ul>
<li><a href="#101-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%BC%82%E5%B8%B8%E9%A1%B5%E9%9D%A2">10.1. 开发环境异常页面</a></li>
<li><a href="#102-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6-useexceptionhandler">10.2. 生产环境异常处理中间件 (<code>UseExceptionHandler</code>)</a></li>
<li><a href="#103-problemdetails-%E8%A7%84%E8%8C%83">10.3. <code>ProblemDetails</code> 规范</a></li>
<li><a href="#104-%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95-ilogger">10.4. 日志记录 (<code>ILogger</code>)</a></li>
</ul>
<h2 id="11-安全性-Security"><a href="#11-安全性-Security" class="headerlink" title="11. 安全性 (Security)"></a><a href="#11-%E5%AE%89%E5%85%A8%E6%80%A7-security">11. 安全性 (Security)</a></h2><ul>
<li><a href="#111-https">11.1. HTTPS</a></li>
<li><a href="#112-%E8%AE%A4%E8%AF%81-authentication">11.2. 认证 (Authentication)</a><ul>
<li><a href="#jwt-json-web-tokens">JWT (JSON Web Tokens)</a></li>
<li><a href="#cookie-%E8%AE%A4%E8%AF%81-%E9%80%82%E7%94%A8%E4%BA%8E-web-%E5%BA%94%E7%94%A8api-%E4%B8%AD%E8%BE%83%E5%B0%91">Cookie 认证 (适用于 Web 应用，API 中较少)</a></li>
<li><a href="#1123-aspnet-core-identity">ASP.NET Core Identity</a></li>
</ul>
</li>
<li><a href="#113-%E6%8E%88%E6%9D%83-authorization">11.3. 授权 (Authorization)</a><ul>
<li><a href="#authorize-%E7%89%B9%E6%80%A7"><code>[Authorize]</code> 特性</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E6%8E%88%E6%9D%83-role-based">基于角色的授权 (Role-based)</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E7%AD%96%E7%95%A5%E7%9A%84%E6%8E%88%E6%9D%83-policy-based">基于策略的授权 (Policy-based)</a></li>
</ul>
</li>
<li><a href="#114-cors-cross-origin-resource-sharing">11.4. CORS (Cross-Origin Resource Sharing)</a></li>
<li><a href="#115-%E9%98%B2%E6%AD%A2%E5%B8%B8%E8%A7%81-web-%E6%BC%8F%E6%B4%9E-xss-csrf---api-%E7%9B%B8%E5%85%B3%E6%80%A7">11.5. 防止常见 Web 漏洞 (XSS, CSRF - API 相关性)</a></li>
<li><a href="#116-api-%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86">11.6. API 密钥管理</a></li>
</ul>
<h2 id="12-API-版本控制-Versioning"><a href="#12-API-版本控制-Versioning" class="headerlink" title="12. API 版本控制 (Versioning)"></a><a href="#12-api-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6-versioning">12. API 版本控制 (Versioning)</a></h2><ul>
<li><a href="#121-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-api-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">12.1. 为什么需要 API 版本控制?</a></li>
<li><a href="#122-%E5%B8%B8%E8%A7%81%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5">12.2. 常见版本控制策略</a></li>
<li><a href="#123-%E4%BD%BF%E7%94%A8-aspversioning-%E5%BA%93">12.3. 使用 <code>Asp.Versioning</code> 库</a></li>
</ul>
<h2 id="13-API-文档-Swagger-OpenAPI"><a href="#13-API-文档-Swagger-OpenAPI" class="headerlink" title="13. API 文档 (Swagger&#x2F;OpenAPI)"></a><a href="#13-api-%E6%96%87%E6%A1%A3-swaggeropenapi">13. API 文档 (Swagger&#x2F;OpenAPI)</a></h2><ul>
<li><a href="#131-openapi-%E8%A7%84%E8%8C%83">13.1. OpenAPI 规范</a></li>
<li><a href="#132-%E4%BD%BF%E7%94%A8-swashbuckleaspnetcore">13.2. 使用 Swashbuckle.AspNetCore</a></li>
<li><a href="#133-%E4%BD%BF%E7%94%A8-nswag-%E5%A4%87%E9%80%89%E6%96%B9%E6%A1%88">13.3. 使用 NSwag (备选方案)</a></li>
</ul>
<h2 id="14-测试-Web-API"><a href="#14-测试-Web-API" class="headerlink" title="14. 测试 Web API"></a><a href="#14-%E6%B5%8B%E8%AF%95-web-api">14. 测试 Web API</a></h2><ul>
<li><a href="#141-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">14.1. 单元测试</a></li>
<li><a href="#142-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95-webapplicationfactory">14.2. 集成测试 (<code>WebApplicationFactory</code>)</a></li>
</ul>
<h2 id="15-高级主题"><a href="#15-高级主题" class="headerlink" title="15. 高级主题"></a><a href="#15-%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98">15. 高级主题</a></h2><ul>
<li><a href="#151-%E8%BF%87%E6%BB%A4%E5%99%A8-filters">15.1. 过滤器 (Filters)</a></li>
<li><a href="#152-%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6-rate-limiting">15.2. 速率限制 (Rate Limiting)</a></li>
<li><a href="#153-%E7%BC%93%E5%AD%98-caching">15.3. 缓存 (Caching)</a></li>
<li><a href="#154-%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E4%B8%8E%E6%89%98%E7%AE%A1%E6%9C%8D%E5%8A%A1-ihostedservice">15.4. 后台任务与托管服务 (<code>IHostedService</code>)</a></li>
<li><a href="#155-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5-health-checks">15.5. 健康检查 (Health Checks)</a></li>
<li><a href="#156-grpc-%E4%BD%9C%E4%B8%BA-rest-api-%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%88%96%E8%A1%A5%E5%85%85">15.6. gRPC (作为 REST API 的替代或补充)</a></li>
</ul>
<h2 id="16-部署-ASP-NET-Core-Web-API"><a href="#16-部署-ASP-NET-Core-Web-API" class="headerlink" title="16. 部署 ASP.NET Core Web API"></a><a href="#16-%E9%83%A8%E7%BD%B2-aspnet-core-web-api">16. 部署 ASP.NET Core Web API</a></h2><ul>
<li><a href="#161-%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8">16.1. 发布应用</a></li>
<li><a href="#162-%E6%89%98%E7%AE%A1%E6%A8%A1%E5%9E%8B-%E8%BF%9B%E7%A8%8B%E5%86%85-vs-%E8%BF%9B%E7%A8%8B%E5%A4%96---%E4%B8%BB%E8%A6%81%E9%92%88%E5%AF%B9-iis">16.2. 托管模型 (进程内 vs. 进程外 - 主要针对 IIS)</a></li>
<li><a href="#163-%E5%B8%B8%E8%A7%81%E6%89%98%E7%AE%A1%E7%8E%AF%E5%A2%83-iis-kestrel-nginxapache-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-docker-azure-app-service-aws-%E7%AD%89">16.3. 常见托管环境 (IIS, Kestrel, Nginx&#x2F;Apache 反向代理, Docker, Azure App Service, AWS 等)</a></li>
</ul>
<h2 id="17-最佳实践"><a href="#17-最佳实践" class="headerlink" title="17. 最佳实践"></a><a href="#17-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">17. 最佳实践</a></h2><h2 id="18-总结与未来展望"><a href="#18-总结与未来展望" class="headerlink" title="18. 总结与未来展望"></a><a href="#18-%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">18. 总结与未来展望</a></h2><hr>
<h2 id="1-ASP-NET-Core-Web-API-简介-1"><a href="#1-ASP-NET-Core-Web-API-简介-1" class="headerlink" title="1. ASP.NET Core Web API 简介"></a>1. ASP.NET Core Web API 简介</h2><h3 id="1-1-什么是-ASP-NET-Core"><a href="#1-1-什么是-ASP-NET-Core" class="headerlink" title="1.1. 什么是 ASP.NET Core?"></a>1.1. 什么是 ASP.NET Core?</h3><p>ASP.NET Core 是一个现代化、开源、跨平台的框架，用于构建基于云的、联网的应用程序，如 Web 应用、IoT 应用和移动后端。它由微软和 .NET 社区共同开发，是 ASP.NET Framework 的下一代演进版本，具有更高的性能、模块化设计和灵活性。</p>
<h3 id="1-2-什么是-Web-API"><a href="#1-2-什么是-Web-API" class="headerlink" title="1.2. 什么是 Web API?"></a>1.2. 什么是 Web API?</h3><p>Web API (应用程序编程接口) 是一种允许不同软件应用程序通过网络（通常是 HTTP 协议）进行通信的接口。它定义了一组规则和协议，使得客户端（如浏览器、移动应用或其他服务）可以请求数据或执行操作，而无需了解服务端的内部实现。</p>
<p>ASP.NET Core Web API 是使用 ASP.NET Core 构建 HTTP 服务的框架，这些服务可以被广泛的客户端访问。</p>
<h3 id="1-3-RESTful-API-设计原则"><a href="#1-3-RESTful-API-设计原则" class="headerlink" title="1.3. RESTful API 设计原则"></a>1.3. RESTful API 设计原则</h3><p>REST (Representational State Transfer) 是一种用于设计网络应用程序的架构风格。符合 REST 原则的 API 通常称为 RESTful API。主要原则包括：</p>
<ul>
<li><strong>客户端-服务器 (Client-Server)</strong>: 清晰分离关注点。</li>
<li><strong>无状态 (Stateless)</strong>: 服务器不应在请求之间存储任何客户端状态。每个请求都应包含处理它所需的所有信息。</li>
<li><strong>可缓存 (Cacheable)</strong>: 响应应可被客户端或中间层缓存，以提高性能。</li>
<li><strong>统一接口 (Uniform Interface)</strong>:<ul>
<li><strong>资源标识 (Identification of resources)</strong>: 通过 URI (统一资源标识符) 标识资源。</li>
<li><strong>通过表述修改资源 (Manipulation of resources through representations)</strong>: 客户端通过操作资源的表述（如 JSON, XML）来修改服务器上的资源。</li>
<li><strong>自描述消息 (Self-descriptive messages)</strong>: 请求和响应应包含足够的信息以自我描述（如 HTTP 方法、媒体类型）。</li>
<li><strong>超媒体作为应用状态的引擎 (HATEOAS - Hypermedia as the Engine of Application State)</strong>: 响应中应包含链接，引导客户端发现其他可用资源和操作。</li>
</ul>
</li>
<li><strong>分层系统 (Layered System)</strong>: 客户端通常不知道它是否直接连接到最终服务器，还是连接到中间层。</li>
<li><strong>按需代码 (Code on demand - 可选)</strong>: 服务器可以通过脚本或小程序临时扩展客户端功能。</li>
</ul>
<h3 id="1-4-为什么选择-ASP-NET-Core-Web-API"><a href="#1-4-为什么选择-ASP-NET-Core-Web-API" class="headerlink" title="1.4. 为什么选择 ASP.NET Core Web API?"></a>1.4. 为什么选择 ASP.NET Core Web API?</h3><ul>
<li><strong>高性能</strong>: ASP.NET Core 是目前性能最高的 Web 框架之一。</li>
<li><strong>跨平台</strong>: 可以在 Windows, macOS 和 Linux 上开发和部署。</li>
<li><strong>现代化</strong>: 支持最新的 Web 标准和开发实践，如依赖注入、异步编程、中间件架构。</li>
<li><strong>灵活性</strong>: 可以选择使用控制器或更轻量级的最小 API 来构建服务。</li>
<li><strong>与 .NET 生态系统集成</strong>: 无缝利用 NuGet 包、Entity Framework Core、ASP.NET Core Identity 等。</li>
<li><strong>强大的工具支持</strong>: Visual Studio, Visual Studio Code, .NET CLI 提供了出色的开发体验。</li>
<li><strong>开源与社区驱动</strong>: 拥有活跃的社区和持续的改进。</li>
</ul>
<h2 id="2-环境搭建与第一个-API-1"><a href="#2-环境搭建与第一个-API-1" class="headerlink" title="2. 环境搭建与第一个 API"></a>2. 环境搭建与第一个 API</h2><h3 id="2-1-先决条件"><a href="#2-1-先决条件" class="headerlink" title="2.1. 先决条件"></a>2.1. 先决条件</h3><ul>
<li><strong>.NET SDK</strong>: 安装最新版本的 .NET SDK (推荐 .NET 8 或 .NET 9)。可以从 <a target="_blank" rel="noopener" href="https://dot.net/">dot.net</a> 下载。</li>
<li><strong>代码编辑器&#x2F;IDE</strong>:<ul>
<li>Visual Studio 2022 (或更高版本)</li>
<li>Visual Studio Code (配合 C# Dev Kit 扩展)</li>
<li>JetBrains Rider</li>
</ul>
</li>
</ul>
<h3 id="2-2-创建新项目-CLI-与-Visual-Studio"><a href="#2-2-创建新项目-CLI-与-Visual-Studio" class="headerlink" title="2.2. 创建新项目 (CLI 与 Visual Studio)"></a>2.2. 创建新项目 (CLI 与 Visual Studio)</h3><h4 id="使用-NET-CLI"><a href="#使用-NET-CLI" class="headerlink" title="使用 .NET CLI"></a>使用 .NET CLI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个使用控制器的 Web API 项目</span></span><br><span class="line">dotnet new webapi -o MyFirstApiApp --use-controllers</span><br><span class="line"><span class="comment"># 或者，创建一个最小 API 项目 (默认 .NET 6+)</span></span><br><span class="line"><span class="comment"># dotnet new webapi -o MyMinimalApiApp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> MyFirstApiApp</span><br></pre></td></tr></table></figure>

<p><code>--use-controllers</code> 标志会创建一个包含示例 <code>WeatherForecastController</code> 的项目。如果不加此标志（在 .NET 6+ 中），默认创建的是最小 API 项目。</p>
<h4 id="使用-Visual-Studio"><a href="#使用-Visual-Studio" class="headerlink" title="使用 Visual Studio"></a>使用 Visual Studio</h4><ol>
<li>打开 Visual Studio。</li>
<li>选择 “创建新项目”。</li>
<li>搜索并选择 “ASP.NET Core Web API” 模板。</li>
<li>配置项目名称、位置，选择目标框架 (.NET 8.0 或 .NET 9.0)。</li>
<li>在 “其他信息” 页面，可以选择是否 “使用控制器 (取消勾选以使用最小 API)”。建议初学者从勾选 “使用控制器” 开始，或直接体验最小 API。</li>
<li>确保 “为 OpenAPI 配置” (启用 Swagger) 已勾选。</li>
</ol>
<h3 id="2-3-项目结构概览-基于控制器的模板"><a href="#2-3-项目结构概览-基于控制器的模板" class="headerlink" title="2.3. 项目结构概览 (基于控制器的模板)"></a>2.3. 项目结构概览 (基于控制器的模板)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MyFirstApiApp/</span><br><span class="line">├── Controllers/              # 存放 API 控制器类</span><br><span class="line">│   └── WeatherForecastController.cs</span><br><span class="line">├── Properties/</span><br><span class="line">│   └── launchSettings.json   # 启动配置 (IIS Express, Kestrel)</span><br><span class="line">├── appsettings.json          # 应用配置文件</span><br><span class="line">├── appsettings.Development.json # 开发环境特定配置</span><br><span class="line">├── MyFirstApiApp.csproj      # 项目文件</span><br><span class="line">├── Program.cs                # 应用入口点和配置</span><br><span class="line">└── WeatherForecast.cs        # 示例模型类 (DTO)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>wwwroot/</code> 文件夹 (如果创建 Web 应用或添加静态文件支持)</strong>: 存放静态文件 (HTML, CSS, JS, 图像)。对于纯 Web API，此文件夹可能不存在或为空。</li>
</ul>
<h3 id="2-4-Program-cs-应用的起点"><a href="#2-4-Program-cs-应用的起点" class="headerlink" title="2.4. Program.cs - 应用的起点"></a>2.4. <code>Program.cs</code> - 应用的起点</h3><p>在 .NET 6 及更高版本中，<code>Program.cs</code> 采用了新的顶级语句 (top-level statements) 格式，更加简洁。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs (示例, .NET 8/9 风格)</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 添加服务到容器 (Dependency Injection)</span></span><br><span class="line">builder.Services.AddControllers(); <span class="comment">// 如果使用控制器</span></span><br><span class="line"><span class="comment">// builder.Services.AddProblemDetails(); // .NET 8+ 推荐的错误处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 学习 Swagger/OpenAPI 相关知识</span></span><br><span class="line">builder.Services.AddEndpointsApiExplorer(); <span class="comment">// 用于 API 浏览器和 Swagger</span></span><br><span class="line">builder.Services.AddSwaggerGen();          <span class="comment">// 配置 Swagger 生成器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 配置 HTTP 请求处理管道 (Middleware)</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();             <span class="comment">// 启用 Swagger 中间件</span></span><br><span class="line">    app.UseSwaggerUI();           <span class="comment">// 启用 Swagger UI</span></span><br><span class="line">    app.UseDeveloperExceptionPage(); <span class="comment">// 开发环境异常页面</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    app.UseExceptionHandler(<span class="string">&quot;/Error&quot;</span>); <span class="comment">// 生产环境异常处理</span></span><br><span class="line">    <span class="comment">// app.UseProblemDetails(); // .NET 8+</span></span><br><span class="line">    app.UseHsts(); <span class="comment">// 强制 HTTPS (生产)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.UseHttpsRedirection(); <span class="comment">// 将 HTTP 请求重定向到 HTTPS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.UseStaticFiles(); // 如果需要提供静态文件</span></span><br><span class="line"></span><br><span class="line">app.UseRouting();         <span class="comment">// 启用路由中间件</span></span><br><span class="line"></span><br><span class="line">app.UseAuthentication();  <span class="comment">// 启用认证中间件 (如果配置了认证)</span></span><br><span class="line">app.UseAuthorization();   <span class="comment">// 启用授权中间件</span></span><br><span class="line"></span><br><span class="line">app.MapControllers();     <span class="comment">// 映射控制器路由 (如果使用控制器)</span></span><br><span class="line"><span class="comment">// 或者定义最小 API 端点</span></span><br><span class="line"><span class="comment">// app.MapGet(&quot;/weatherforecast&quot;, () =&gt; &#123; /* ... */ &#125;);</span></span><br><span class="line"></span><br><span class="line">app.Run(); <span class="comment">// 启动应用</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>WebApplication.CreateBuilder(args)</code></strong>: 初始化一个新的 <code>WebApplicationBuilder</code> 实例。</li>
<li><strong><code>builder.Services</code></strong>: <code>IServiceCollection</code>，用于注册依赖注入服务。</li>
<li><strong><code>builder.Build()</code></strong>: 构建 <code>WebApplication</code> 实例。</li>
<li><strong><code>app</code></strong>: <code>IApplicationBuilder</code> (隐式)，用于配置 HTTP 请求处理管道中的中间件。</li>
</ul>
<h3 id="2-5-运行与测试你的第一个-API"><a href="#2-5-运行与测试你的第一个-API" class="headerlink" title="2.5. 运行与测试你的第一个 API"></a>2.5. 运行与测试你的第一个 API</h3><ul>
<li><strong>CLI</strong>: <code>dotnet run</code></li>
<li><strong>Visual Studio</strong>: 点击 “启动” 按钮 (通常是绿色三角，可以选择 Kestrel 或 IIS Express)。</li>
</ul>
<p>应用启动后，通常会自动打开浏览器并导航到 Swagger UI 页面 (例如 <code>https://localhost:xxxx/swagger</code>)。你可以在 Swagger UI 上查看 API 文档并直接发送请求进行测试。<br>也可以使用 Postman, Insomnia 或 <code>curl</code> 等工具测试 API 端点。</p>
<h2 id="3-控制器-Controllers-vs-最小-API-Minimal-APIs-1"><a href="#3-控制器-Controllers-vs-最小-API-Minimal-APIs-1" class="headerlink" title="3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)"></a>3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)</h2><p>ASP.NET Core 提供了两种主要方式来构建 Web API 端点。</p>
<h3 id="3-1-基于控制器的-API"><a href="#3-1-基于控制器的-API" class="headerlink" title="3.1. 基于控制器的 API"></a>3.1. 基于控制器的 API</h3><ul>
<li>类继承自 <code>ControllerBase</code> (或 <code>Controller</code>，如果需要视图支持，但 API 通常用 <code>ControllerBase</code>)。</li>
<li>通常用 <code>[ApiController]</code> 特性标记，该特性会启用一些有用的约定行为（如自动模型验证并返回 400 错误，推断绑定源等）。</li>
<li>操作方法 (Actions) 是类中的公共方法，通常用 HTTP 动词特性 (<code>[HttpGet]</code>, <code>[HttpPost]</code>等) 和路由特性 (<code>[Route]</code>) 标记。</li>
<li><strong>优点</strong>: 结构清晰，易于组织大型 API，非常适合传统的 MVC&#x2F;MVVM 模式，面向对象特性（如过滤器、依赖注入）集成良好。</li>
<li><strong>缺点</strong>: 对于简单的 API，可能会显得有些冗余（需要创建类、方法、特性等）。</li>
</ul>
<!-- end list -->

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controllers/ProductsController.cs</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/[controller]&quot;</span>)</span>] <span class="comment">// 路由模板: api/Products</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;<span class="built_in">string</span>&gt; _products = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Laptop&quot;</span>, <span class="string">&quot;Mouse&quot;</span>, <span class="string">&quot;Keyboard&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpGet</span>] <span class="comment">// GET api/products</span></span><br><span class="line">    <span class="keyword">public</span> ActionResult&lt;IEnumerable&lt;<span class="built_in">string</span>&gt;&gt; GetProducts()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Ok(_products);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpGet(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>] <span class="comment">// GET api/products/1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult&lt;<span class="built_in">string</span>&gt; <span class="title">GetProductById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (id &lt; <span class="number">0</span> || id &gt;= _products.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> NotFound(<span class="string">$&quot;Product with id <span class="subst">&#123;id&#125;</span> not found.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Ok(_products[id]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... POST, PUT, DELETE 方法 ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-最小-API"><a href="#3-2-最小-API" class="headerlink" title="3.2. 最小 API"></a>3.2. 最小 API</h3><p>.NET 6 引入，并在后续版本中不断增强。允许直接在 <code>Program.cs</code> (或其他地方) 使用 lambda 表达式或方法来定义 API 端点，无需控制器的样板代码。</p>
<ul>
<li><strong>优点</strong>: 代码简洁，启动速度快，非常适合微服务或小型、简单的 API。易于上手。</li>
<li><strong>缺点</strong>: 对于大型、复杂的 API，组织和维护所有端点在单个文件中可能变得困难（尽管可以将它们组织到不同的文件中或使用路由组）。某些高级控制器特性（如模型绑定器的细粒度控制、复杂的过滤器管道）可能需要更多手动配置。</li>
</ul>
<!-- end list -->

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs (或通过扩展方法组织到其他文件)</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"><span class="comment">// ... (AddServices)</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"><span class="comment">// ... (Configure Pipeline)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _products = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Laptop&quot;</span>, <span class="string">&quot;Mouse&quot;</span>, <span class="string">&quot;Keyboard&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /api/minimal/products</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/api/minimal/products&quot;</span>, () =&gt; Results.Ok(_products));</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /api/minimal/products/&#123;id&#125;</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/api/minimal/products/&#123;id:int&#125;&quot;</span>, (<span class="built_in">int</span> id) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span> || id &gt;= _products.Count)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Results.NotFound(<span class="string">$&quot;Product with id <span class="subst">&#123;id&#125;</span> not found.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Results.Ok(_products[id]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ... MapPost, MapPut, MapDelete ...</span></span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<h3 id="3-3-如何选择"><a href="#3-3-如何选择" class="headerlink" title="3.3. 如何选择?"></a>3.3. 如何选择?</h3><ul>
<li><strong>简单、快速、微服务</strong>: 最小 API 通常是更好的选择。</li>
<li><strong>大型、复杂、企业级应用，需要清晰结构和组织</strong>: 基于控制器的 API 可能更合适。</li>
<li><strong>团队熟悉度</strong>: 如果团队熟悉 MVC 模式，控制器可能更容易过渡。<br>两者可以混合使用在同一个项目中。</li>
</ul>
<h2 id="4-路由-Routing-1"><a href="#4-路由-Routing-1" class="headerlink" title="4. 路由 (Routing)"></a>4. 路由 (Routing)</h2><p>路由是将传入的 HTTP 请求映射到特定处理程序（控制器操作或最小 API 委托）的机制。</p>
<h3 id="4-1-路由基础"><a href="#4-1-路由基础" class="headerlink" title="4.1. 路由基础"></a>4.1. 路由基础</h3><p>路由系统解析请求的 URL 路径，并根据配置的路由模板和约束来确定哪个代码应该处理该请求。</p>
<h3 id="4-2-基于属性的路由-Controllers"><a href="#4-2-基于属性的路由-Controllers" class="headerlink" title="4.2. 基于属性的路由 (Controllers)"></a>4.2. 基于属性的路由 (Controllers)</h3><p>这是构建 Web API 时最常用的路由方式。</p>
<ul>
<li><p><strong><code>[Route]</code> 特性</strong>: 可以应用于控制器类或操作方法。</p>
<ul>
<li>控制器级别: <code>[Route(&quot;api/[controller]&quot;)]</code> - <code>[controller]</code> 令牌会被替换为控制器名称（不含 “Controller” 后缀）。</li>
<li>操作方法级别: 可以定义相对于控制器路由的子路由，或覆盖控制器路由。</li>
</ul>
</li>
<li><p><strong>HTTP 动词特性</strong>: <code>[HttpGet]</code>, <code>[HttpPost]</code>, <code>[HttpPut]</code>, <code>[HttpDelete]</code>, <code>[HttpPatch]</code> 也可包含路由模板。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/v1/items&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet</span>] <span class="comment">// -&gt; GET api/v1/items</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetAll</span>()</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> Ok(); &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpGet(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>] <span class="comment">// -&gt; GET api/v1/items/&#123;id&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> Ok(); &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpPost</span>] <span class="comment">// -&gt; POST api/v1/items</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Create</span>(<span class="params"><span class="built_in">object</span> item</span>)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> CreatedAtAction(<span class="keyword">nameof</span>(GetById), <span class="keyword">new</span> &#123;id = <span class="number">1</span>&#125;, item); &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="string">&quot;special&quot;</span>)</span>] <span class="comment">// -&gt; GET api/v1/items/special</span></span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetSpecial</span>()</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> Ok(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-3-路由在最小-API-中的实现"><a href="#4-3-路由在最小-API-中的实现" class="headerlink" title="4.3. 路由在最小 API 中的实现"></a>4.3. 路由在最小 API 中的实现</h3><p>使用 <code>Map&#123;HttpVerb&#125;</code> 扩展方法直接在 <code>WebApplication</code> 实例上定义路由和处理程序。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.MapGet(<span class="string">&quot;/products&quot;</span>, () =&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">app.MapPost(<span class="string">&quot;/products&quot;</span>, (Product product) =&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">app.MapPut(<span class="string">&quot;/products/&#123;id&#125;&quot;</span>, (<span class="built_in">int</span> id, Product product) =&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">app.MapDelete(<span class="string">&quot;/products/&#123;id&#125;&quot;</span>, (<span class="built_in">int</span> id) =&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由组 (Route Groups - .NET 7+)</span></span><br><span class="line"><span class="keyword">var</span> usersGroup = app.MapGroup(<span class="string">&quot;/api/users&quot;</span>).WithTags(<span class="string">&quot;Users API&quot;</span>); <span class="comment">// WithTags 用于 OpenAPI</span></span><br><span class="line">usersGroup.MapGet(<span class="string">&quot;/&quot;</span>, () =&gt; &#123; <span class="comment">/* GET /api/users */</span> &#125;);</span><br><span class="line">usersGroup.MapGet(<span class="string">&quot;/&#123;id&#125;&quot;</span>, (<span class="built_in">int</span> id) =&gt; &#123; <span class="comment">/* GET /api/users/&#123;id&#125; */</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-4-路由参数与约束"><a href="#4-4-路由参数与约束" class="headerlink" title="4.4. 路由参数与约束"></a>4.4. 路由参数与约束</h3><ul>
<li><p><strong>路由参数</strong>: 在路由模板中用 <code>&#123;&#125;</code> 定义，如 <code>&quot;&#123;id&#125;&quot;</code>。参数值会绑定到操作方法的参数。</p>
</li>
<li><p><strong>路由约束</strong>: 限制路由参数可以接受的值类型或格式。</p>
<ul>
<li><code>&quot;&#123;id:int&#125;&quot;</code>: id 必须是整数。</li>
<li><code>&quot;&#123;name:alpha&#125;&quot;</code>: name 必须是字母。</li>
<li>其他约束: <code>bool</code>, <code>datetime</code>, <code>decimal</code>, <code>double</code>, <code>float</code>, <code>guid</code>, <code>long</code>, <code>minlength</code>, <code>maxlength</code>, <code>length</code>, <code>min</code>, <code>max</code>, <code>range</code>, <code>regex</code>。<!-- end list --></li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;productcode/&#123;code:length(6):alpha&#125;&quot;</span>)</span>] <span class="comment">// 长度为6的字母code</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetByProductCode</span>(<span class="params"><span class="built_in">string</span> code</span>)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> Ok(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Minimal API</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/items/&#123;itemId:guid&#125;&quot;</span>, (Guid itemId) =&gt; &#123; <span class="comment">/* ... */</span> &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-5-路由命名与链接生成"><a href="#4-5-路由命名与链接生成" class="headerlink" title="4.5. 路由命名与链接生成"></a>4.5. 路由命名与链接生成</h3><p>可以为路由命名，以便在代码中生成指向这些路由的链接 (例如，在创建资源后返回 <code>Location</code> 响应头)。</p>
<ul>
<li><p><strong>控制器</strong>: <code>[HttpGet(Name = &quot;GetProductById&quot;)]</code></p>
</li>
<li><p><strong>最小 API</strong>: <code>.WithName(&quot;GetProductById&quot;)</code></p>
</li>
<li><p><strong>链接生成</strong>: 使用 <code>LinkGenerator</code> 服务或 <code>Url.Link()</code> &#x2F; <code>Url.RouteUrl()</code> (在控制器中)。<code>Results.CreatedAtRoute()</code> (在最小 API 中)。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller</span></span><br><span class="line"><span class="comment">// return CreatedAtAction(nameof(GetById), new &#123; id = newItem.Id &#125;, newItem);</span></span><br><span class="line"><span class="comment">// return CreatedAtRoute(&quot;GetProductById&quot;, new &#123; id = newItem.Id &#125;, newItem);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Minimal API</span></span><br><span class="line"><span class="comment">// return Results.CreatedAtRoute(&quot;GetProductByIdMinimal&quot;, new &#123; id = newItem.Id &#125;, newItem);</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/minimal/items/&#123;id&#125;&quot;</span>, (<span class="built_in">int</span> id) =&gt; &#123; <span class="comment">/* ... */</span> &#125;).WithName(<span class="string">&quot;GetProductByIdMinimal&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-HTTP-动词与操作方法-Actions-1"><a href="#5-HTTP-动词与操作方法-Actions-1" class="headerlink" title="5. HTTP 动词与操作方法 (Actions)"></a>5. HTTP 动词与操作方法 (Actions)</h2><h3 id="5-1-理解-HTTP-动词-GET-POST-PUT-DELETE-PATCH-等"><a href="#5-1-理解-HTTP-动词-GET-POST-PUT-DELETE-PATCH-等" class="headerlink" title="5.1. 理解 HTTP 动词 (GET, POST, PUT, DELETE, PATCH 等)"></a>5.1. 理解 HTTP 动词 (GET, POST, PUT, DELETE, PATCH 等)</h3><p>HTTP 动词（也称方法）定义了对资源执行的操作：</p>
<ul>
<li><strong>GET</strong>: 请求获取指定资源的表示。安全且幂等。</li>
<li><strong>POST</strong>: 向服务器提交数据以创建新资源，或执行其他非幂等操作。</li>
<li><strong>PUT</strong>: 用请求中的数据替换目标资源的全部当前内容。幂等。</li>
<li><strong>DELETE</strong>: 删除指定的资源。幂等。</li>
<li><strong>PATCH</strong>: 对资源应用部分修改。通常非幂等，但也可以设计成幂等。</li>
<li><strong>HEAD</strong>: 类似 GET，但只返回响应头，不返回响应体。安全且幂等。</li>
<li><strong>OPTIONS</strong>: 获取目标资源支持的通信选项（如允许的 HTTP 方法）。安全且幂等。</li>
</ul>
<h3 id="5-2-在控制器中映射动词"><a href="#5-2-在控制器中映射动词" class="headerlink" title="5.2. 在控制器中映射动词"></a>5.2. 在控制器中映射动词</h3><p>使用 HTTP 动词特性：</p>
<ul>
<li><code>[HttpGet]</code></li>
<li><code>[HttpPost]</code></li>
<li><code>[HttpPut]</code></li>
<li><code>[HttpDelete]</code></li>
<li><code>[HttpPatch]</code></li>
<li><code>[HttpHead]</code></li>
<li><code>[HttpOptions]</code></li>
</ul>
<h3 id="5-3-在最小-API-中映射动词"><a href="#5-3-在最小-API-中映射动词" class="headerlink" title="5.3. 在最小 API 中映射动词"></a>5.3. 在最小 API 中映射动词</h3><p>使用 <code>IEndpointRouteBuilder</code> 的扩展方法：</p>
<ul>
<li><code>app.MapGet()</code></li>
<li><code>app.MapPost()</code></li>
<li><code>app.MapPut()</code></li>
<li><code>app.MapDelete()</code></li>
<li><code>app.MapPatch()</code></li>
<li>(对于 HEAD, OPTIONS 等，可以用 <code>app.MapMethods(pattern, new[] &#123;&quot;HEAD&quot;, &quot;OPTIONS&quot;&#125;, handler)</code>)</li>
</ul>
<h2 id="6-数据处理：模型绑定、验证与响应-1"><a href="#6-数据处理：模型绑定、验证与响应-1" class="headerlink" title="6. 数据处理：模型绑定、验证与响应"></a>6. 数据处理：模型绑定、验证与响应</h2><h3 id="6-1-模型绑定-Model-Binding"><a href="#6-1-模型绑定-Model-Binding" class="headerlink" title="6.1. 模型绑定 (Model Binding)"></a>6.1. 模型绑定 (Model Binding)</h3><p>模型绑定是将传入 HTTP 请求中的数据（如来自路由、查询字符串、请求体）转换为操作方法参数的过程。ASP.NET Core 会自动尝试从不同来源绑定数据。</p>
<h4 id="绑定源-FromRoute-FromQuery-FromBody-FromHeader-FromForm"><a href="#绑定源-FromRoute-FromQuery-FromBody-FromHeader-FromForm" class="headerlink" title="绑定源 ([FromRoute], [FromQuery], [FromBody], [FromHeader], [FromForm])"></a>绑定源 (<code>[FromRoute]</code>, <code>[FromQuery]</code>, <code>[FromBody]</code>, <code>[FromHeader]</code>, <code>[FromForm]</code>)</h4><p>可以通过这些特性显式指定参数的绑定来源：</p>
<ul>
<li><code>[FromRoute]</code>: 从路由数据中获取值。</li>
<li><code>[FromQuery]</code>: 从查询字符串中获取值。</li>
<li><code>[FromHeader]</code>: 从 HTTP 请求头中获取值。</li>
<li><code>[FromBody]</code>: 从 HTTP 请求体中获取值（通常用于 JSON 或 XML 数据）。一个操作方法通常最多只能有一个 <code>[FromBody]</code> 参数。</li>
<li><code>[FromForm]</code>: 从 POST 请求的表单数据中获取值。</li>
<li><strong>推断</strong>: <code>[ApiController]</code> 会尝试推断绑定源。复杂类型通常假定为 <code>[FromBody]</code>，简单类型按顺序尝试路由、查询字符串等。最小 API 也有类似的推断逻辑。</li>
</ul>
<!-- end list -->

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller</span></span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">CreateProduct</span>(<span class="params">[FromBody] ProductDto product, [FromQuery] <span class="built_in">string</span> category, [FromHeader(Name = <span class="string">&quot;X-API-KEY&quot;</span></span>)] <span class="built_in">string</span> apiKey)</span></span><br><span class="line">&#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> Ok(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Minimal API</span></span><br><span class="line">app.MapPost(<span class="string">&quot;/create&quot;</span>, (ProductDto product, [FromQuery] <span class="built_in">string</span> category, [FromHeader(Name = <span class="string">&quot;X-API-KEY&quot;</span>)] <span class="built_in">string</span> apiKey) =&gt;</span><br><span class="line">&#123; <span class="comment">/* ... */</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-数据验证-Data-Validation"><a href="#6-2-数据验证-Data-Validation" class="headerlink" title="6.2. 数据验证 (Data Validation)"></a>6.2. 数据验证 (Data Validation)</h3><p>确保传入的数据符合预期格式和约束。</p>
<h4 id="数据注解-Data-Annotations"><a href="#数据注解-Data-Annotations" class="headerlink" title="数据注解 (Data Annotations)"></a>数据注解 (Data Annotations)</h4><p>在模型类 (DTO - Data Transfer Object) 的属性上使用 <code>System.ComponentModel.DataAnnotations</code> 中的特性。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreateProductDto</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Required(ErrorMessage = <span class="string">&quot;Product name is required.&quot;</span>)</span>]</span><br><span class="line">    [<span class="meta">StringLength(100, MinimumLength = 3)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Range(0.01, 10000.00)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">EmailAddress</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span>? SupplierEmail &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常用注解: <code>[Required]</code>, <code>[StringLength]</code>, <code>[Range]</code>, <code>[RegularExpression]</code>, <code>[EmailAddress]</code>, <code>[Url]</code>, <code>[Compare]</code>, <code>[CreditCard]</code>.</p>
<h4 id="FluentValidation-第三方库"><a href="#FluentValidation-第三方库" class="headerlink" title="FluentValidation (第三方库)"></a>FluentValidation (第三方库)</h4><p>一个流行的 .NET 库，提供更灵活、更强大的链式 API 来定义验证规则，并将验证逻辑与模型类分离。</p>
<h4 id="ModelState-与自动-HTTP-400-响应"><a href="#ModelState-与自动-HTTP-400-响应" class="headerlink" title="ModelState 与自动 HTTP 400 响应"></a><code>ModelState</code> 与自动 HTTP 400 响应</h4><ul>
<li>对于标记了 <code>[ApiController]</code> 的控制器，如果模型绑定或验证失败，ASP.NET Core 会自动用包含错误详情的 <code>ProblemDetails</code> 响应返回 HTTP 400 (Bad Request)。</li>
<li>在操作方法内部，可以检查 <code>ModelState.IsValid</code> 属性。</li>
<li>最小 API 默认不自动执行此操作，但可以通过过滤器或手动检查来实现。在 .NET 7+ 中，如果参数是 <code>IValidatableObject</code> 或使用了数据注解，最小 API 也会进行验证，但行为可能需要通过 <code>IEndpointFilter</code> 定制。</li>
</ul>
<h3 id="6-3-返回响应-Responses"><a href="#6-3-返回响应-Responses" class="headerlink" title="6.3. 返回响应 (Responses)"></a>6.3. 返回响应 (Responses)</h3><h4 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h4><p>使用适当的 HTTP 状态码来指示请求的结果：</p>
<ul>
<li><strong>2xx (成功)</strong>:<ul>
<li><code>200 OK</code>: 请求成功。</li>
<li><code>201 Created</code>: 资源创建成功 (通常 POST 后返回，并在 <code>Location</code> 头中包含新资源的 URI)。</li>
<li><code>204 No Content</code>: 请求成功，但没有内容返回 (通常 DELETE 或 PUT 成功后返回)。</li>
</ul>
</li>
<li><strong>3xx (重定向)</strong>: 较少直接用于 API。</li>
<li><strong>4xx (客户端错误)</strong>:<ul>
<li><code>400 Bad Request</code>: 请求无效（如格式错误、验证失败）。</li>
<li><code>401 Unauthorized</code>: 未经身份验证。</li>
<li><code>403 Forbidden</code>: 已认证，但无权访问该资源。</li>
<li><code>404 Not Found</code>: 未找到请求的资源。</li>
<li><code>405 Method Not Allowed</code>: 请求的 HTTP 方法不被允许。</li>
<li><code>409 Conflict</code>: 请求冲突 (如尝试创建已存在的资源)。</li>
<li><code>422 Unprocessable Entity</code>: 请求格式正确，但由于语义错误无法处理。</li>
</ul>
</li>
<li><strong>5xx (服务器错误)</strong>:<ul>
<li><code>500 Internal Server Error</code>: 服务器内部发生意外错误。</li>
</ul>
</li>
</ul>
<h4 id="IActionResult-与-ActionResult"><a href="#IActionResult-与-ActionResult" class="headerlink" title="IActionResult 与 ActionResult&lt;T&gt;"></a><code>IActionResult</code> 与 <code>ActionResult&lt;T&gt;</code></h4><p>在控制器中，操作方法通常返回这些类型，以便对 HTTP 响应有更多控制。</p>
<ul>
<li><code>IActionResult</code>: 一个通用接口，表示操作方法的结果。有很多内置实现：<ul>
<li><code>Ok(value)</code>: 200 OK</li>
<li><code>NotFound()</code>: 404 Not Found</li>
<li><code>BadRequest(modelStateOrError)</code>: 400 Bad Request</li>
<li><code>CreatedAtAction(actionName, routeValues, value)</code>: 201 Created</li>
<li><code>NoContent()</code>: 204 No Content</li>
<li><code>StatusCode(statusCode, value)</code>: 返回指定状态码。</li>
</ul>
</li>
<li><code>ActionResult&lt;T&gt;</code>: 结合了 <code>IActionResult</code> 的灵活性和返回特定类型 <code>T</code> 的能力。如果返回 <code>T</code> 的实例，则框架假定为 <code>Ok(value)</code>。<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> ActionResult&lt;ProductDto&gt; <span class="title">GetProduct</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> product = _productService.GetById(id);</span><br><span class="line">    <span class="keyword">if</span> (product == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> NotFound(); <span class="comment">// 返回 404</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> product; <span class="comment">// 隐式返回 Ok(product) - 200</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="最小-API-中的-Results-类型"><a href="#最小-API-中的-Results-类型" class="headerlink" title="最小 API 中的 Results 类型"></a>最小 API 中的 <code>Results</code> 类型</h4><p>最小 API 使用 <code>Microsoft.AspNetCore.Http.Results</code> 静态类中的方法来创建响应。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.MapGet(<span class="string">&quot;/items/&#123;id&#125;&quot;</span>, (<span class="built_in">int</span> id) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> item = GetItemById(id); <span class="comment">// 假设有这个方法</span></span><br><span class="line">    <span class="keyword">return</span> item != <span class="literal">null</span> ? Results.Ok(item) : Results.NotFound();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.MapPost(<span class="string">&quot;/items&quot;</span>, (Item item) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> newItem = CreateItem(item);</span><br><span class="line">    <span class="keyword">return</span> Results.CreatedAtRoute(<span class="string">&quot;GetItemById&quot;</span>, <span class="keyword">new</span> &#123; id = newItem.Id &#125;, newItem); <span class="comment">// 假设有名为 &quot;GetItemById&quot; 的路由</span></span><br><span class="line">&#125;).WithName(<span class="string">&quot;CreateItem&quot;</span>); <span class="comment">// 命名路由</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-内容协商-Content-Negotiation-简介"><a href="#6-4-内容协商-Content-Negotiation-简介" class="headerlink" title="6.4. 内容协商 (Content Negotiation - 简介)"></a>6.4. 内容协商 (Content Negotiation - 简介)</h3><p>客户端可以通过 <code>Accept</code> 请求头指定其期望的响应格式 (如 <code>application/json</code>, <code>application/xml</code>)。服务器根据其能力和客户端的偏好选择合适的格式。ASP.NET Core 默认支持 JSON，可以通过配置添加对 XML 等其他格式的支持。</p>
<h3 id="6-5-输入与输出格式化器-Formatters"><a href="#6-5-输入与输出格式化器-Formatters" class="headerlink" title="6.5. 输入与输出格式化器 (Formatters)"></a>6.5. 输入与输出格式化器 (Formatters)</h3><p>格式化器负责将 HTTP 请求体反序列化为对象，以及将对象序列化为 HTTP 响应体。</p>
<ul>
<li>默认使用 <code>System.Text.Json</code> 进行 JSON 序列化&#x2F;反序列化。</li>
<li>可以通过 <code>builder.Services.AddControllers().AddXmlSerializerFormatters()</code> 添加对 XML 的支持。</li>
<li>可以创建自定义格式化器。</li>
</ul>
<h2 id="7-依赖注入-Dependency-Injection-DI-1"><a href="#7-依赖注入-Dependency-Injection-DI-1" class="headerlink" title="7. 依赖注入 (Dependency Injection - DI)"></a>7. 依赖注入 (Dependency Injection - DI)</h2><h3 id="7-1-DI-核心概念"><a href="#7-1-DI-核心概念" class="headerlink" title="7.1. DI 核心概念"></a>7.1. DI 核心概念</h3><p>依赖注入是一种设计模式，其中一个对象（客户端）的依赖项（服务）由外部实体（DI 容器）提供，而不是由对象自己创建。这促进了松耦合和可测试性。</p>
<h3 id="7-2-服务生命周期-Singleton-Scoped-Transient"><a href="#7-2-服务生命周期-Singleton-Scoped-Transient" class="headerlink" title="7.2. 服务生命周期 (Singleton, Scoped, Transient)"></a>7.2. 服务生命周期 (Singleton, Scoped, Transient)</h3><p>ASP.NET Core 的 DI 容器支持三种主要的服务生命周期：</p>
<ul>
<li><strong>Singleton</strong>: 在应用程序的整个生命周期中只创建一个实例。所有请求共享同一个实例。</li>
<li><strong>Scoped</strong>: 在每个客户端请求（作用域）内创建一个实例。在同一请求中，多次请求该服务会得到同一个实例。</li>
<li><strong>Transient</strong>: 每次请求服务时都会创建一个新实例。</li>
</ul>
<h3 id="7-3-注册服务-Program-cs"><a href="#7-3-注册服务-Program-cs" class="headerlink" title="7.3. 注册服务 (Program.cs)"></a>7.3. 注册服务 (<code>Program.cs</code>)</h3><p>在 <code>Program.cs</code> 中使用 <code>builder.Services</code> 的扩展方法注册服务：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// public interface IMyService &#123; string GetData(); &#125;</span></span><br><span class="line"><span class="comment">// public class MyService : IMyService &#123; public string GetData() =&gt; &quot;Data from MyService&quot;; &#125;</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddSingleton&lt;IMyService, MyService&gt;();</span><br><span class="line"><span class="comment">// builder.Services.AddScoped&lt;IMyScopedService, MyScopedService&gt;();</span></span><br><span class="line"><span class="comment">// builder.Services.AddTransient&lt;IMyTransientService, MyTransientService&gt;();</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-注入服务-构造函数注入-操作方法注入"><a href="#7-4-注入服务-构造函数注入-操作方法注入" class="headerlink" title="7.4. 注入服务 (构造函数注入, 操作方法注入)"></a>7.4. 注入服务 (构造函数注入, 操作方法注入)</h3><ul>
<li><p><strong>构造函数注入 (推荐)</strong>: 服务通过类的构造函数注入。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValuesController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IMyService _myService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValuesController</span>(<span class="params">IMyService myService</span>) <span class="comment">// 构造函数注入</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        _myService = myService;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>()</span> =&gt; _myService.GetData();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Minimal API (C# 12+ primary constructors)</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/data&quot;</span>, (IMyService myService) =&gt; myService.GetData());</span><br><span class="line"><span class="comment">// Or if handler is a method:</span></span><br><span class="line"><span class="comment">// string GetHandler(IMyService myService) =&gt; myService.GetData();</span></span><br><span class="line"><span class="comment">// app.MapGet(&quot;/data&quot;, GetHandler);</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>操作方法注入 (<code>[FromServices]</code>)</strong>: 服务直接注入到控制器操作方法或最小 API 处理程序的参数中。通常用于仅在特定操作中需要的服务。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller</span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;action-injection&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetWithActionInjection</span>(<span class="params">[FromServices] IMyService myService</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> myService.GetData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="8-配置-Configuration-1"><a href="#8-配置-Configuration-1" class="headerlink" title="8. 配置 (Configuration)"></a>8. 配置 (Configuration)</h2><h3 id="8-1-appsettings-json-与环境特定配置"><a href="#8-1-appsettings-json-与环境特定配置" class="headerlink" title="8.1. appsettings.json 与环境特定配置"></a>8.1. <code>appsettings.json</code> 与环境特定配置</h3><p>ASP.NET Core 使用分层的配置系统。默认配置源包括：</p>
<ul>
<li><code>appsettings.json</code> (基础配置)</li>
<li><code>appsettings.&#123;Environment&#125;.json</code> (如 <code>appsettings.Development.json</code>, <code>appsettings.Production.json</code>)，根据当前环境覆盖基础配置。</li>
<li>环境变量</li>
<li>命令行参数</li>
</ul>
<!-- end list -->

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// appsettings.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Logging&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;LogLevel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Information&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Microsoft.AspNetCore&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Warning&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;AllowedHosts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;MyApiSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ApiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-secret-key&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;MaxItems&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-读取配置数据-IConfiguration"><a href="#8-2-读取配置数据-IConfiguration" class="headerlink" title="8.2. 读取配置数据 (IConfiguration)"></a>8.2. 读取配置数据 (<code>IConfiguration</code>)</h3><p><code>IConfiguration</code> 服务已默认注册，可以注入到类中以访问配置值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller or Service</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> IConfiguration _configuration;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyConfigReader</span>(<span class="params">IConfiguration configuration</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _configuration = configuration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetApiKey</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _configuration[<span class="string">&quot;MyApiSettings:ApiKey&quot;</span>];</span><br><span class="line">    <span class="comment">// 或者: return _configuration.GetValue&lt;string&gt;(&quot;MyApiSettings:ApiKey&quot;);</span></span><br><span class="line">    <span class="comment">// 或者: return _configuration.GetSection(&quot;MyApiSettings&quot;)[&quot;ApiKey&quot;];</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-选项模式-Options-Pattern"><a href="#8-3-选项模式-Options-Pattern" class="headerlink" title="8.3. 选项模式 (Options Pattern)"></a>8.3. 选项模式 (Options Pattern)</h3><p>一种将相关配置设置组合到强类型 POCO (Plain Old CLR Object) 类中的模式。</p>
<ol>
<li><strong>定义选项类</strong>:<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyApiSettings</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ApiKey &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MaxItems &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>在 <code>Program.cs</code> 中配置</strong>:<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.Configure&lt;MyApiSettings&gt;(builder.Configuration.GetSection(<span class="string">&quot;MyApiSettings&quot;</span>));</span><br></pre></td></tr></table></figure></li>
<li><strong>注入和使用 <code>IOptions&lt;T&gt;</code></strong>:<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller or Service</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> MyApiSettings _settings;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MySettingsConsumer</span>(<span class="params">IOptions&lt;MyApiSettings&gt; options</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _settings = options.Value; <span class="comment">// .Value 获取 MyApiSettings 实例</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomething</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;API Key: <span class="subst">&#123;_settings.ApiKey&#125;</span>, Max Items: <span class="subst">&#123;_settings.MaxItems&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<code>IOptionsSnapshot&lt;T&gt;</code> 用于作用域生命周期，<code>IOptionsMonitor&lt;T&gt;</code> 用于响应配置更改。</li>
</ol>
<h2 id="9-中间件-Middleware-1"><a href="#9-中间件-Middleware-1" class="headerlink" title="9. 中间件 (Middleware)"></a>9. 中间件 (Middleware)</h2><h3 id="9-1-什么是中间件"><a href="#9-1-什么是中间件" class="headerlink" title="9.1. 什么是中间件?"></a>9.1. 什么是中间件?</h3><p>中间件是组装到应用程序管道中以处理请求和响应的软件组件。每个组件：</p>
<ul>
<li>选择是否将请求传递给管道中的下一个组件。</li>
<li>可以在调用下一个组件之前和之后执行工作。</li>
</ul>
<h3 id="9-2-请求处理管道-Request-Pipeline"><a href="#9-2-请求处理管道-Request-Pipeline" class="headerlink" title="9.2. 请求处理管道 (Request Pipeline)"></a>9.2. 请求处理管道 (Request Pipeline)</h3><p>ASP.NET Core 中的请求处理管道由一系列中间件组件构成。每个传入的 HTTP 请求都会依次通过这些中间件，每个中间件都可以检查、修改请求或响应，或短路管道。中间件的顺序非常重要。<br>(图片来源: Microsoft Docs)</p>
<h3 id="9-3-内置中间件示例"><a href="#9-3-内置中间件示例" class="headerlink" title="9.3. 内置中间件示例"></a>9.3. 内置中间件示例</h3><p>在 <code>Program.cs</code> 中通过 <code>app.Use...()</code> 方法添加：</p>
<ul>
<li><code>app.UseHttpsRedirection()</code>: 将 HTTP 重定向到 HTTPS。</li>
<li><code>app.UseStaticFiles()</code>: 提供静态文件服务。</li>
<li><code>app.UseRouting()</code>: 向管道添加路由匹配。</li>
<li><code>app.UseCors()</code>: 配置跨域资源共享。</li>
<li><code>app.UseAuthentication()</code>: 启用身份验证。</li>
<li><code>app.UseAuthorization()</code>: 启用授权。</li>
<li><code>app.UseExceptionHandler()</code>: 捕获未处理的异常。</li>
<li><code>app.MapControllers()</code> &#x2F; <code>app.MapGet()</code>等: 将请求分派到端点。</li>
</ul>
<h3 id="9-4-编写自定义中间件"><a href="#9-4-编写自定义中间件" class="headerlink" title="9.4. 编写自定义中间件"></a>9.4. 编写自定义中间件</h3><p>可以通过约定或实现 <code>IMiddleware</code> 接口来创建。</p>
<ul>
<li><p><strong>约定方式 (使用 <code>RequestDelegate</code>)</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CustomMiddleware.cs</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyCustomMiddleware</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> RequestDelegate _next;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;MyCustomMiddleware&gt; _logger;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyCustomMiddleware</span>(<span class="params">RequestDelegate next, ILogger&lt;MyCustomMiddleware&gt; logger</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _next = next;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">InvokeAsync</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _logger.LogInformation(<span class="string">&quot;MyCustomMiddleware: Handling request...&quot;</span>);</span><br><span class="line">        <span class="comment">// 在调用下一个中间件之前执行操作</span></span><br><span class="line">        context.Items[<span class="string">&quot;CustomMiddlewareData&quot;</span>] = <span class="string">&quot;Hello from Middleware!&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> _next(context); <span class="comment">// 调用管道中的下一个中间件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在调用下一个中间件之后执行操作</span></span><br><span class="line">        _logger.LogInformation(<span class="string">&quot;MyCustomMiddleware: Finished handling request.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extension method for easy registration (optional but good practice)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">MyCustomMiddlewareExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IApplicationBuilder <span class="title">UseMyCustomMiddleware</span>(<span class="params"><span class="keyword">this</span> IApplicationBuilder builder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.UseMiddleware&lt;MyCustomMiddleware&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// app.UseMyCustomMiddleware();</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>IMiddleware</code> 接口方式</strong>: 更适合需要依赖注入的中间件。</p>
</li>
</ul>
<h2 id="10-错误处理与日志记录-1"><a href="#10-错误处理与日志记录-1" class="headerlink" title="10. 错误处理与日志记录"></a>10. 错误处理与日志记录</h2><h3 id="10-1-开发环境异常页面"><a href="#10-1-开发环境异常页面" class="headerlink" title="10.1. 开发环境异常页面"></a>10.1. 开发环境异常页面</h3><p><code>app.UseDeveloperExceptionPage();</code> (通常在 <code>if (app.Environment.IsDevelopment())</code>)<br>提供详细的异常信息，方便开发时调试。</p>
<h3 id="10-2-生产环境异常处理中间件-UseExceptionHandler"><a href="#10-2-生产环境异常处理中间件-UseExceptionHandler" class="headerlink" title="10.2. 生产环境异常处理中间件 (UseExceptionHandler)"></a>10.2. 生产环境异常处理中间件 (<code>UseExceptionHandler</code>)</h3><p><code>app.UseExceptionHandler(&quot;/Error&quot;);</code> (将用户重定向到错误处理路径)<br>或 <code>app.UseExceptionHandler(appBuilder =&gt; &#123; /* 自定义处理逻辑 */ &#125;);</code><br>这会捕获后续中间件中未处理的异常，并生成错误响应。</p>
<h3 id="10-3-ProblemDetails-规范"><a href="#10-3-ProblemDetails-规范" class="headerlink" title="10.3. ProblemDetails 规范"></a>10.3. <code>ProblemDetails</code> 规范</h3><p>RFC 7807 定义了一种标准的、机器可读的 HTTP API 错误详情格式。<br>.NET 7+ 引入了 <code>IProblemDetailsService</code> 和 <code>app.UseProblemDetails()</code> (需要 <code>builder.Services.AddProblemDetails()</code>) 来简化生成 <code>ProblemDetails</code> 响应。<br><code>[ApiController]</code> 控制器在模型验证失败时会自动返回 <code>ProblemDetails</code> 格式的 HTTP 400 响应。</p>
<h3 id="10-4-日志记录-ILogger"><a href="#10-4-日志记录-ILogger" class="headerlink" title="10.4. 日志记录 (ILogger)"></a>10.4. 日志记录 (<code>ILogger</code>)</h3><p>ASP.NET Core 内置了日志记录系统，支持多种日志提供程序（控制台、Debug、EventSource、EventLog 等），也可以集成第三方日志框架 (Serilog, NLog)。</p>
<ul>
<li>注入 <code>ILogger&lt;TCategoryName&gt;</code>:<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller or Service</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;MyService&gt; _logger;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyService</span>(<span class="params">ILogger&lt;MyService&gt; logger</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _logger = logger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoWork</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    _logger.LogInformation(<span class="string">&quot;Doing work at &#123;Time&#125;&quot;</span>, DateTime.UtcNow);</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123; _logger.LogError(ex, <span class="string">&quot;Error during work&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>日志级别: Trace, Debug, Information, Warning, Error, Critical.</li>
<li>配置在 <code>appsettings.json</code> 中。</li>
</ul>
<h2 id="11-安全性-Security-1"><a href="#11-安全性-Security-1" class="headerlink" title="11. 安全性 (Security)"></a>11. 安全性 (Security)</h2><h3 id="11-1-HTTPS"><a href="#11-1-HTTPS" class="headerlink" title="11.1. HTTPS"></a>11.1. HTTPS</h3><p>始终在生产环境中使用 HTTPS 来加密通信。<code>app.UseHttpsRedirection()</code> 和 <code>app.UseHsts()</code> 有助于强制 HTTPS。</p>
<h3 id="11-2-认证-Authentication"><a href="#11-2-认证-Authentication" class="headerlink" title="11.2. 认证 (Authentication)"></a>11.2. 认证 (Authentication)</h3><p>验证请求者的身份。</p>
<h4 id="JWT-JSON-Web-Tokens"><a href="#JWT-JSON-Web-Tokens" class="headerlink" title="JWT (JSON Web Tokens)"></a>JWT (JSON Web Tokens)</h4><p>一种流行的无状态认证机制。客户端在登录后获取 JWT，并在后续请求的 <code>Authorization</code> 头中携带它 (<code>Bearer &lt;token&gt;</code>)。</p>
<ul>
<li>配置:<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)</span></span><br><span class="line"><span class="comment">//     .AddJwtBearer(options =&gt;</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         options.TokenValidationParameters = new TokenValidationParameters</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             ValidateIssuer = true,</span></span><br><span class="line"><span class="comment">//             ValidateAudience = true,</span></span><br><span class="line"><span class="comment">//             ValidateLifetime = true,</span></span><br><span class="line"><span class="comment">//             ValidateIssuerSigningKey = true,</span></span><br><span class="line"><span class="comment">//             ValidIssuer = builder.Configuration[&quot;Jwt:Issuer&quot;],</span></span><br><span class="line"><span class="comment">//             ValidAudience = builder.Configuration[&quot;Jwt:Audience&quot;],</span></span><br><span class="line"><span class="comment">//             IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(builder.Configuration[&quot;Jwt:Key&quot;]))</span></span><br><span class="line"><span class="comment">//         &#125;;</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// app.UseAuthentication();</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Cookie-认证-适用于-Web-应用，API-中较少"><a href="#Cookie-认证-适用于-Web-应用，API-中较少" class="headerlink" title="Cookie 认证 (适用于 Web 应用，API 中较少)"></a>Cookie 认证 (适用于 Web 应用，API 中较少)</h4><p>主要用于传统的 Web 应用程序，状态通过 Cookie 维护。对于无状态 API，JWT 更常见。</p>
<h4 id="11-2-3-ASP-NET-Core-Identity"><a href="#11-2-3-ASP-NET-Core-Identity" class="headerlink" title="11.2.3 ASP.NET Core Identity"></a>11.2.3 ASP.NET Core Identity</h4><p>一个完整的成员资格系统，包括用户管理、密码哈希、双因素认证等。可以与 JWT 或 Cookie 认证结合使用。</p>
<h3 id="11-3-授权-Authorization"><a href="#11-3-授权-Authorization" class="headerlink" title="11.3. 授权 (Authorization)"></a>11.3. 授权 (Authorization)</h3><p>确定经过身份验证的用户是否有权执行请求的操作或访问资源。</p>
<h4 id="Authorize-特性"><a href="#Authorize-特性" class="headerlink" title="[Authorize] 特性"></a><code>[Authorize]</code> 特性</h4><p>应用于控制器、操作方法或最小 API 端点，要求用户必须经过身份验证。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Authorize</span>]</span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/securedata&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SecureDataController</span> : <span class="title">ControllerBase</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Minimal API</span></span><br><span class="line">app.MapGet(<span class="string">&quot;/secure&quot;</span>, () =&gt; <span class="string">&quot;Secure data&quot;</span>).RequireAuthorization();</span><br></pre></td></tr></table></figure>

<h4 id="基于角色的授权-Role-based"><a href="#基于角色的授权-Role-based" class="headerlink" title="基于角色的授权 (Role-based)"></a>基于角色的授权 (Role-based)</h4><p><code>[Authorize(Roles = &quot;Admin,User&quot;)]</code><br>要求用户属于指定的角色之一。</p>
<h4 id="基于策略的授权-Policy-based"><a href="#基于策略的授权-Policy-based" class="headerlink" title="基于策略的授权 (Policy-based)"></a>基于策略的授权 (Policy-based)</h4><p>提供更灵活、更细粒度的授权控制。策略在 <code>Program.cs</code> 中定义。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// builder.Services.AddAuthorization(options =&gt;</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     options.AddPolicy(&quot;RequireAdminRole&quot;, policy =&gt; policy.RequireRole(&quot;Admin&quot;));</span></span><br><span class="line"><span class="comment">//     options.AddPolicy(&quot;MinimumAge21&quot;, policy =&gt;</span></span><br><span class="line"><span class="comment">//         policy.Requirements.Add(new MinimumAgeRequirement(21))); // 自定义 Requirement 和 Handler</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller/Action/Endpoint</span></span><br><span class="line"><span class="comment">// [Authorize(Policy = &quot;MinimumAge21&quot;)]</span></span><br><span class="line"><span class="comment">// app.MapGet(&quot;/adults-only&quot;, () =&gt; &quot;Content for 21+&quot;).RequireAuthorization(&quot;MinimumAge21&quot;);</span></span><br></pre></td></tr></table></figure>

<h3 id="11-4-CORS-Cross-Origin-Resource-Sharing"><a href="#11-4-CORS-Cross-Origin-Resource-Sharing" class="headerlink" title="11.4. CORS (Cross-Origin Resource Sharing)"></a>11.4. CORS (Cross-Origin Resource Sharing)</h3><p>浏览器安全机制，阻止网页向不同源（域、协议、端口）的服务器发出某些类型的请求。如果你的 API 需要被不同源的 Web 应用调用，则需要配置 CORS。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// var MyAllowSpecificOrigins = &quot;_myAllowSpecificOrigins&quot;;</span></span><br><span class="line"><span class="comment">// builder.Services.AddCors(options =&gt;</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     options.AddPolicy(name: MyAllowSpecificOrigins,</span></span><br><span class="line"><span class="comment">//                       policy  =&gt;</span></span><br><span class="line"><span class="comment">//                       &#123;</span></span><br><span class="line"><span class="comment">//                           policy.WithOrigins(&quot;https.example.com&quot;, &quot;http://localhost:3000&quot;)</span></span><br><span class="line"><span class="comment">//                                 .AllowAnyHeader()</span></span><br><span class="line"><span class="comment">//                                 .AllowAnyMethod();</span></span><br><span class="line"><span class="comment">//                       &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// app.UseCors(MyAllowSpecificOrigins); // 必须在 UseRouting 和 UseAuthorization/UseEndpoints 之间</span></span><br></pre></td></tr></table></figure>

<h3 id="11-5-防止常见-Web-漏洞-XSS-CSRF-API-相关性"><a href="#11-5-防止常见-Web-漏洞-XSS-CSRF-API-相关性" class="headerlink" title="11.5. 防止常见 Web 漏洞 (XSS, CSRF - API 相关性)"></a>11.5. 防止常见 Web 漏洞 (XSS, CSRF - API 相关性)</h3><ul>
<li><strong>XSS (Cross-Site Scripting)</strong>: API 主要返回数据（如 JSON），XSS 风险更多地在消费 API 的前端应用中。确保 API 不会意外地返回可执行脚本或 HTML。</li>
<li><strong>CSRF (Cross-Site Request Forgery)</strong>: 主要影响基于 Cookie 认证的 Web 应用。对于使用 Token (如 JWT) 认证的无状态 API，CSRF 风险较低，但仍需注意 Cookie 的使用场景。</li>
<li><strong>输入验证</strong>: 始终验证所有输入数据。</li>
<li><strong>参数化查询</strong>: 防止 SQL 注入（如果直接操作数据库）。</li>
</ul>
<h3 id="11-6-API-密钥管理"><a href="#11-6-API-密钥管理" class="headerlink" title="11.6. API 密钥管理"></a>11.6. API 密钥管理</h3><p>对于需要服务器到服务器通信或第三方应用访问的 API，通常使用 API 密钥进行简单的认证。密钥应保密，并通过安全的 HTTP 头（如 <code>X-API-KEY</code>）传递。</p>
<h2 id="12-API-版本控制-Versioning-1"><a href="#12-API-版本控制-Versioning-1" class="headerlink" title="12. API 版本控制 (Versioning)"></a>12. API 版本控制 (Versioning)</h2><h3 id="12-1-为什么需要-API-版本控制"><a href="#12-1-为什么需要-API-版本控制" class="headerlink" title="12.1. 为什么需要 API 版本控制?"></a>12.1. 为什么需要 API 版本控制?</h3><p>当 API 需要进行重大（不向后兼容）的更改时，版本控制允许你引入这些更改，而不会破坏现有客户端的集成。</p>
<h3 id="12-2-常见版本控制策略"><a href="#12-2-常见版本控制策略" class="headerlink" title="12.2. 常见版本控制策略"></a>12.2. 常见版本控制策略</h3><ul>
<li><strong>URL 路径版本控制</strong>: <code>https://api.example.com/v1/products</code> (最常见)</li>
<li><strong>查询字符串版本控制</strong>: <code>https://api.example.com/products?api-version=1.0</code></li>
<li><strong>HTTP Header 版本控制</strong>: 使用自定义请求头 (如 <code>X-API-VERSION: 1.0</code>) 或 <code>Accept</code> 头 (如 <code>Accept: application/vnd.example.v1+json</code>)。</li>
</ul>
<h3 id="12-3-使用-Asp-Versioning-库"><a href="#12-3-使用-Asp-Versioning-库" class="headerlink" title="12.3. 使用 Asp.Versioning 库"></a>12.3. 使用 <code>Asp.Versioning</code> 库</h3><p><code>Asp.Versioning.Mvc</code> (以前是 <code>Microsoft.AspNetCore.Mvc.Versioning</code>) 和 <code>Asp.Versioning.Mvc.ApiExplorer</code> (用于 Swagger 集成) 是流行的库。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// builder.Services.AddApiVersioning(options =&gt;</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     options.DefaultApiVersion = new ApiVersion(1, 0);</span></span><br><span class="line"><span class="comment">//     options.AssumeDefaultVersionWhenUnspecified = true;</span></span><br><span class="line"><span class="comment">//     options.ReportApiVersions = true; // 在响应头中报告支持的版本和废弃的版本</span></span><br><span class="line"><span class="comment">//     options.ApiVersionReader = ApiVersionReader.Combine(</span></span><br><span class="line"><span class="comment">//         new UrlSegmentApiVersionReader(), // /api/v1/...</span></span><br><span class="line"><span class="comment">//         new QueryStringApiVersionReader(&quot;api-version&quot;), // ?api-version=1.0</span></span><br><span class="line"><span class="comment">//         new HeaderApiVersionReader(&quot;x-api-version&quot;));   // x-api-version: 1.0</span></span><br><span class="line"><span class="comment">// &#125;).AddMvc().AddApiExplorer(options =&gt;</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     options.GroupNameFormat = &quot;&#x27;v&#x27;VVV&quot;; // v1, v2, etc.</span></span><br><span class="line"><span class="comment">//     options.SubstituteApiVersionInUrl = true;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller</span></span><br><span class="line"><span class="comment">// [ApiVersion(&quot;1.0&quot;)]</span></span><br><span class="line"><span class="comment">// [ApiVersion(&quot;2.0&quot;)]</span></span><br><span class="line"><span class="comment">// [Route(&quot;api/v&#123;version:apiVersion&#125;/[controller]&quot;)]</span></span><br><span class="line"><span class="comment">// public class ValuesController : ControllerBase &#123; /* ... */ &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [MapToApiVersion(&quot;2.0&quot;)] // 将特定操作映射到特定版本</span></span><br><span class="line"><span class="comment">// [HttpGet]</span></span><br><span class="line"><span class="comment">// public string GetV2() =&gt; &quot;Version 2&quot;;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-API-文档-Swagger-OpenAPI-1"><a href="#13-API-文档-Swagger-OpenAPI-1" class="headerlink" title="13. API 文档 (Swagger&#x2F;OpenAPI)"></a>13. API 文档 (Swagger&#x2F;OpenAPI)</h2><h3 id="13-1-OpenAPI-规范"><a href="#13-1-OpenAPI-规范" class="headerlink" title="13.1. OpenAPI 规范"></a>13.1. OpenAPI 规范</h3><p>OpenAPI 规范（前身为 Swagger 规范）是一种用于描述、生成、消费和可视化 RESTful Web 服务的与语言无关的接口规范。</p>
<h3 id="13-2-使用-Swashbuckle-AspNetCore"><a href="#13-2-使用-Swashbuckle-AspNetCore" class="headerlink" title="13.2. 使用 Swashbuckle.AspNetCore"></a>13.2. 使用 Swashbuckle.AspNetCore</h3><p>一个流行的库，用于根据你的 API 控制器和模型自动生成 OpenAPI 文档，并提供 Swagger UI。</p>
<ul>
<li><p><strong>安装</strong>: <code>Install-Package Swashbuckle.AspNetCore</code></p>
</li>
<li><p><strong>配置 (<code>Program.cs</code>)</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.SwaggerDoc(<span class="string">&quot;v1&quot;</span>, <span class="keyword">new</span> OpenApiInfo</span><br><span class="line">    &#123;</span><br><span class="line">        Version = <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">        Title = <span class="string">&quot;My API V1&quot;</span>,</span><br><span class="line">        Description = <span class="string">&quot;An ASP.NET Core Web API for managing items&quot;</span>,</span><br><span class="line">        TermsOfService = <span class="keyword">new</span> Uri(<span class="string">&quot;https://example.com/terms&quot;</span>),</span><br><span class="line">        Contact = <span class="keyword">new</span> OpenApiContact &#123; Name = <span class="string">&quot;Support&quot;</span>, Email = <span class="string">&quot;support@example.com&quot;</span> &#125;,</span><br><span class="line">        License = <span class="keyword">new</span> OpenApiLicense &#123; Name = <span class="string">&quot;MIT License&quot;</span>, Url = <span class="keyword">new</span> Uri(<span class="string">&quot;https://opensource.org/licenses/MIT&quot;</span>) &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 为 JWT 认证添加安全定义 (可选)</span></span><br><span class="line">    <span class="comment">// options.AddSecurityDefinition(&quot;Bearer&quot;, new OpenApiSecurityScheme &#123; /* ... */ &#125;);</span></span><br><span class="line">    <span class="comment">// options.AddSecurityRequirement(new OpenApiSecurityRequirement &#123; /* ... */ &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (可选) 包含 XML 注释</span></span><br><span class="line">    <span class="comment">// var xmlFilename = $&quot;&#123;Assembly.GetExecutingAssembly().GetName().Name&#125;.xml&quot;;</span></span><br><span class="line">    <span class="comment">// options.IncludeXmlComments(Path.Combine(AppContext.BaseDirectory, xmlFilename));</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();</span><br><span class="line">    app.UseSwaggerUI(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        options.SwaggerEndpoint(<span class="string">&quot;/swagger/v1/swagger.json&quot;</span>, <span class="string">&quot;My API V1&quot;</span>);</span><br><span class="line">        <span class="comment">// options.RoutePrefix = string.Empty; // 如果想在根路径访问 Swagger UI</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>要包含 XML 注释，需要在项目文件 <code>.csproj</code> 中启用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GenerateDocumentationFile</span>&gt;</span>true<span class="tag">&lt;/<span class="name">GenerateDocumentationFile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">NoWarn</span>&gt;</span>$(NoWarn);1591<span class="tag">&lt;/<span class="name">NoWarn</span>&gt;</span> <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="13-3-使用-NSwag-备选方案"><a href="#13-3-使用-NSwag-备选方案" class="headerlink" title="13.3. 使用 NSwag (备选方案)"></a>13.3. 使用 NSwag (备选方案)</h3><p>NSwag 是另一个功能强大的 OpenAPI 工具集，支持代码生成 (客户端和服务端) 等。</p>
<h2 id="14-测试-Web-API-1"><a href="#14-测试-Web-API-1" class="headerlink" title="14. 测试 Web API"></a>14. 测试 Web API</h2><h3 id="14-1-单元测试"><a href="#14-1-单元测试" class="headerlink" title="14.1. 单元测试"></a>14.1. 单元测试</h3><p>测试单个类或方法（如控制器操作、服务）的逻辑，隔离其依赖项（使用模拟 Moq, NSubstitute 等）。</p>
<h3 id="14-2-集成测试-WebApplicationFactory"><a href="#14-2-集成测试-WebApplicationFactory" class="headerlink" title="14.2. 集成测试 (WebApplicationFactory)"></a>14.2. 集成测试 (<code>WebApplicationFactory</code>)</h3><p>测试多个组件的交互，包括请求管道、中间件、模型绑定、过滤器、控制器和依赖注入的服务。<br><code>Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory&lt;TEntryPoint&gt;</code> 用于在内存中托管应用并发送 HTTP 请求进行测试。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyApi.Tests/IntegrationTests.cs (xUnit 示例)</span></span><br><span class="line"><span class="comment">// public class WeatherApiTests : IClassFixture&lt;WebApplicationFactory&lt;Program&gt;&gt; // Program 是入口点类</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     private readonly WebApplicationFactory&lt;Program&gt; _factory;</span></span><br><span class="line"><span class="comment">//     private readonly HttpClient _client;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     public WeatherApiTests(WebApplicationFactory&lt;Program&gt; factory)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         _factory = factory;</span></span><br><span class="line"><span class="comment">//         _client = _factory.CreateClient(); // 创建 HttpClient</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     [Fact]</span></span><br><span class="line"><span class="comment">//     public async Task GetWeatherForecast_ReturnsSuccessAndCorrectContentType()</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         // Act</span></span><br><span class="line"><span class="comment">//         var response = await _client.GetAsync(&quot;/WeatherForecast&quot;); // 假设这是你的一个端点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         // Assert</span></span><br><span class="line"><span class="comment">//         response.EnsureSuccessStatusCode(); // Status Code 200-299</span></span><br><span class="line"><span class="comment">//         Assert.Equal(&quot;application/json; charset=utf-8&quot;,</span></span><br><span class="line"><span class="comment">//             response.Content.Headers.ContentType.ToString());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         var forecasts = await response.Content.ReadFromJsonAsync&lt;IEnumerable&lt;WeatherForecast&gt;&gt;();</span></span><br><span class="line"><span class="comment">//         Assert.NotNull(forecasts);</span></span><br><span class="line"><span class="comment">//         Assert.NotEmpty(forecasts);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="15-高级主题-1"><a href="#15-高级主题-1" class="headerlink" title="15. 高级主题"></a>15. 高级主题</h2><h3 id="15-1-过滤器-Filters"><a href="#15-1-过滤器-Filters" class="headerlink" title="15.1. 过滤器 (Filters)"></a>15.1. 过滤器 (Filters)</h3><p>允许在请求处理管道的特定阶段之前或之后运行代码，用于横切关注点（如日志记录、异常处理、授权、缓存）。</p>
<ul>
<li><strong>类型</strong>: Authorization, Resource, Action, Exception, Result。</li>
<li>可以作为特性应用于控制器或操作方法，或全局注册。<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyActionFilterAttribute</span> : <span class="title">ActionFilterAttribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnActionExecuting</span>(<span class="params">ActionExecutingContext context</span>)</span> &#123; <span class="comment">/* before action */</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnActionExecuted</span>(<span class="params">ActionExecutedContext context</span>)</span> &#123; <span class="comment">/* after action */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [MyActionFilter]</span></span><br><span class="line"><span class="comment">// public class MyController : ControllerBase &#123; &#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>最小 API 使用 <code>IEndpointFilter</code>。</p>
<h3 id="15-2-速率限制-Rate-Limiting"><a href="#15-2-速率限制-Rate-Limiting" class="headerlink" title="15.2. 速率限制 (Rate Limiting)"></a>15.2. 速率限制 (Rate Limiting)</h3><p>限制客户端在给定时间窗口内可以发出的请求数量，以防止滥用。<br>.NET 7+ 引入了内置的速率限制中间件。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// builder.Services.AddRateLimiter(options =&gt;</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     options.AddFixedWindowLimiter(policyName: &quot;fixed&quot;, fixedWindowOptions =&gt;</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         fixedWindowOptions.PermitLimit = 10;</span></span><br><span class="line"><span class="comment">//         fixedWindowOptions.Window = TimeSpan.FromSeconds(12);</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//     options.RejectionStatusCode = StatusCodes.Status429TooManyRequests;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// app.UseRateLimiter();</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// app.MapGet(&quot;/limited&quot;, () =&gt; &quot;Limited content&quot;).RequireRateLimiting(&quot;fixed&quot;);</span></span><br></pre></td></tr></table></figure>

<h3 id="15-3-缓存-Caching"><a href="#15-3-缓存-Caching" class="headerlink" title="15.3. 缓存 (Caching)"></a>15.3. 缓存 (Caching)</h3><ul>
<li><strong>响应缓存 (<code>[ResponseCache]</code>)</strong>: 控制 HTTP 响应的缓存行为（<code>Cache-Control</code> 头等）。</li>
<li><strong>内存缓存 (<code>IMemoryCache</code>)</strong>: 在服务器内存中缓存数据。</li>
<li><strong>分布式缓存 (<code>IDistributedCache</code>)</strong>: 如 Redis, SQL Server，用于多服务器环境。</li>
</ul>
<h3 id="15-4-后台任务与托管服务-IHostedService"><a href="#15-4-后台任务与托管服务-IHostedService" class="headerlink" title="15.4. 后台任务与托管服务 (IHostedService)"></a>15.4. 后台任务与托管服务 (<code>IHostedService</code>)</h3><p>使用 <code>IHostedService</code> 和 <code>BackgroundService</code> 实现长时间运行的后台任务，这些任务与应用程序的生命周期一起启动和停止。</p>
<h3 id="15-5-健康检查-Health-Checks"><a href="#15-5-健康检查-Health-Checks" class="headerlink" title="15.5. 健康检查 (Health Checks)"></a>15.5. 健康检查 (Health Checks)</h3><p>提供一个端点（如 <code>/health</code>），报告应用程序及其依赖项（数据库、外部服务）的健康状况。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="comment">// builder.Services.AddHealthChecks()</span></span><br><span class="line"><span class="comment">//     .AddSqlServer(builder.Configuration.GetConnectionString(&quot;DefaultConnection&quot;), name: &quot;sql-db&quot;);</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// app.MapHealthChecks(&quot;/healthz&quot;);</span></span><br></pre></td></tr></table></figure>

<h3 id="15-6-gRPC-作为-REST-API-的替代或补充"><a href="#15-6-gRPC-作为-REST-API-的替代或补充" class="headerlink" title="15.6. gRPC (作为 REST API 的替代或补充)"></a>15.6. gRPC (作为 REST API 的替代或补充)</h3><p>gRPC 是一个高性能、开源的通用 RPC 框架，使用 Protocol Buffers。与 REST API 相比，它通常提供更好的性能和更强的类型协定，特别适用于内部微服务通信。ASP.NET Core 对 gRPC 有良好支持。</p>
<h2 id="16-部署-ASP-NET-Core-Web-API-1"><a href="#16-部署-ASP-NET-Core-Web-API-1" class="headerlink" title="16. 部署 ASP.NET Core Web API"></a>16. 部署 ASP.NET Core Web API</h2><h3 id="16-1-发布应用"><a href="#16-1-发布应用" class="headerlink" title="16.1. 发布应用"></a>16.1. 发布应用</h3><p>使用 <code>dotnet publish</code> 命令或 Visual Studio 的发布功能。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet publish -c Release -o ./publish_output</span><br></pre></td></tr></table></figure>

<p>这将编译应用并将所有必要的文件（包括依赖项和运行时，如果发布为自包含应用）复制到输出目录。</p>
<h3 id="16-2-托管模型-进程内-vs-进程外-主要针对-IIS"><a href="#16-2-托管模型-进程内-vs-进程外-主要针对-IIS" class="headerlink" title="16.2. 托管模型 (进程内 vs. 进程外 - 主要针对 IIS)"></a>16.2. 托管模型 (进程内 vs. 进程外 - 主要针对 IIS)</h3><ul>
<li><strong>进程内 (In-Process)</strong>: ASP.NET Core 应用直接在 IIS 工作进程 (<code>w3wp.exe</code> 或 <code>iisexpress.exe</code>) 内部运行。性能通常更好。这是 .NET Core 2.2+ 的默认模型。</li>
<li><strong>进程外 (Out-of-Process)</strong>: ASP.NET Core 应用在 Kestrel Web 服务器上独立运行，IIS 作为反向代理将请求转发给 Kestrel。</li>
</ul>
<h3 id="16-3-常见托管环境-IIS-Kestrel-Nginx-Apache-反向代理-Docker-Azure-App-Service-AWS-等"><a href="#16-3-常见托管环境-IIS-Kestrel-Nginx-Apache-反向代理-Docker-Azure-App-Service-AWS-等" class="headerlink" title="16.3. 常见托管环境 (IIS, Kestrel, Nginx&#x2F;Apache 反向代理, Docker, Azure App Service, AWS 等)"></a>16.3. 常见托管环境 (IIS, Kestrel, Nginx&#x2F;Apache 反向代理, Docker, Azure App Service, AWS 等)</h3><ul>
<li><strong>Kestrel</strong>: 跨平台的默认 Web 服务器，快速且轻量。通常与反向代理（如 Nginx, Apache, IIS）结合使用以获得边缘服务器功能（负载均衡、SSL 终止、静态内容服务）。</li>
<li><strong>IIS (Windows)</strong>: 可以作为反向代理或直接托管 (进程内)。需要 ASP.NET Core Hosting Bundle。</li>
<li><strong>Nginx&#x2F;Apache (Linux&#x2F;macOS)</strong>: 常作为 Kestrel 的反向代理。</li>
<li><strong>Docker</strong>: 将应用容器化，便于部署和扩展。</li>
<li><strong>云平台</strong>:<ul>
<li><strong>Azure</strong>: App Service, Azure Kubernetes Service (AKS), Azure Container Apps, Azure Functions.</li>
<li><strong>AWS</strong>: Elastic Beanstalk, Elastic Kubernetes Service (EKS), ECS, Lambda.</li>
<li><strong>Google Cloud</strong>: App Engine, Google Kubernetes Engine (GKE), Cloud Run, Cloud Functions.</li>
</ul>
</li>
</ul>
<h2 id="17-最佳实践-1"><a href="#17-最佳实践-1" class="headerlink" title="17. 最佳实践"></a>17. 最佳实践</h2><ul>
<li><strong>遵循 RESTful 原则</strong>: 使用正确的 HTTP 动词，基于资源设计 URI。</li>
<li><strong>使用 HTTPS</strong>: 始终保护传输中的数据。</li>
<li><strong>版本化 API</strong>: 为重大更改引入新版本。</li>
<li><strong>提供清晰的文档 (OpenAPI&#x2F;Swagger)</strong>.</li>
<li><strong>实现健壮的错误处理</strong>: 返回有意义的错误信息和状态码。</li>
<li><strong>验证所有输入</strong>: 不要信任客户端数据。</li>
<li><strong>使用异步编程 (<code>async</code>&#x2F;<code>await</code>)</strong>: 避免阻塞线程，提高可伸缩性。</li>
<li><strong>保持控制器&#x2F;处理程序简洁</strong>: 将业务逻辑移到服务层。</li>
<li><strong>编写可测试的代码</strong>: 利用 DI，编写单元测试和集成测试。</li>
<li><strong>有效利用缓存</strong>: 减少对后端资源的请求。</li>
<li><strong>实施日志记录和监控</strong>.</li>
<li><strong>考虑安全性</strong>: 认证、授权、防止常见漏洞。</li>
<li><strong>无状态设计</strong>: API 端点应尽可能无状态。</li>
</ul>
<h2 id="18-总结与未来展望-1"><a href="#18-总结与未来展望-1" class="headerlink" title="18. 总结与未来展望"></a>18. 总结与未来展望</h2><p>ASP.NET Core Web API 是一个强大、高性能且灵活的框架，用于构建现代 HTTP 服务。无论是选择传统的基于控制器的模式还是更简洁的最小 API，它都提供了构建健壮、可伸缩和安全 API 所需的全部工具。随着 .NET 生态系统的不断发展 (例如 .NET 8 和 .NET 9 中对性能、AOT 编译、AI 集成等方面的持续投入)，ASP.NET Core Web API 将继续是构建各种 Web 服务和微服务的首选技术之一。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Jackey Zhou</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/05/12/ASP-NET-WEB-API/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/05/12/ASP-NET-WEB-API/')">ASP.NET WEB API</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/05/12/ASP-NET-WEB-API/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=ASP.NET WEB API&amp;url=http://example.com/2025/05/12/ASP-NET-WEB-API/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Welcome To LifeTech's Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/csharp%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>csharp相关学习<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/05/12/blazor-winforms%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">blazor winforms基础知识</div></div></a></div><div class="next-post pull-right"><a href="/2025/05/12/python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">python基础知识</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/05/12/blazor-maui%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="blazor maui基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-12</div><div class="title">blazor maui基础知识</div></div></a></div><div><a href="/2025/05/12/blazor-winforms%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="blazor winforms基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-12</div><div class="title">blazor winforms基础知识</div></div></a></div><div><a href="/2025/05/12/blazor%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="blazor基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-12</div><div class="title">blazor基础知识</div></div></a></div><div><a href="/2025/05/12/csharp%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="csharp基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-12</div><div class="title">csharp基础知识</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">记录技术成长的个人博客</div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ASP-NET-Core-Web-API-Learning-Directory"><span class="toc-number">1.</span> <span class="toc-text">ASP.NET Core Web API Learning Directory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ASP-NET-Core-Web-API-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1. ASP.NET Core Web API 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%AC%AC%E4%B8%80%E4%B8%AA-API"><span class="toc-number">1.2.</span> <span class="toc-text">2. 环境搭建与第一个 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8E%A7%E5%88%B6%E5%99%A8-Controllers-vs-%E6%9C%80%E5%B0%8F-API-Minimal-APIs"><span class="toc-number">1.3.</span> <span class="toc-text">3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1-Routing"><span class="toc-number">1.4.</span> <span class="toc-text">4. 路由 (Routing)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-HTTP-%E5%8A%A8%E8%AF%8D%E4%B8%8E%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95-Actions"><span class="toc-number">1.5.</span> <span class="toc-text">5. HTTP 动词与操作方法 (Actions)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%EF%BC%9A%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A%E3%80%81%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%93%8D%E5%BA%94"><span class="toc-number">1.6.</span> <span class="toc-text">6. 数据处理：模型绑定、验证与响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-Dependency-Injection-DI"><span class="toc-number">1.7.</span> <span class="toc-text">7. 依赖注入 (Dependency Injection - DI)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E9%85%8D%E7%BD%AE-Configuration"><span class="toc-number">1.8.</span> <span class="toc-text">8. 配置 (Configuration)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E4%B8%AD%E9%97%B4%E4%BB%B6-Middleware"><span class="toc-number">1.9.</span> <span class="toc-text">9. 中间件 (Middleware)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">1.10.</span> <span class="toc-text">10. 错误处理与日志记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%AE%89%E5%85%A8%E6%80%A7-Security"><span class="toc-number">1.11.</span> <span class="toc-text">11. 安全性 (Security)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-API-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6-Versioning"><span class="toc-number">1.12.</span> <span class="toc-text">12. API 版本控制 (Versioning)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-API-%E6%96%87%E6%A1%A3-Swagger-OpenAPI"><span class="toc-number">1.13.</span> <span class="toc-text">13. API 文档 (Swagger&#x2F;OpenAPI)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E6%B5%8B%E8%AF%95-Web-API"><span class="toc-number">1.14.</span> <span class="toc-text">14. 测试 Web API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98"><span class="toc-number">1.15.</span> <span class="toc-text">15. 高级主题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E9%83%A8%E7%BD%B2-ASP-NET-Core-Web-API"><span class="toc-number">1.16.</span> <span class="toc-text">16. 部署 ASP.NET Core Web API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.17.</span> <span class="toc-text">17. 最佳实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B"><span class="toc-number">1.18.</span> <span class="toc-text">18. 总结与未来展望</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ASP-NET-Core-Web-API-%E7%AE%80%E4%BB%8B-1"><span class="toc-number">1.19.</span> <span class="toc-text">1. ASP.NET Core Web API 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-ASP-NET-Core"><span class="toc-number">1.19.1.</span> <span class="toc-text">1.1. 什么是 ASP.NET Core?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AF-Web-API"><span class="toc-number">1.19.2.</span> <span class="toc-text">1.2. 什么是 Web API?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-RESTful-API-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.19.3.</span> <span class="toc-text">1.3. RESTful API 设计原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-ASP-NET-Core-Web-API"><span class="toc-number">1.19.4.</span> <span class="toc-text">1.4. 为什么选择 ASP.NET Core Web API?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%AC%AC%E4%B8%80%E4%B8%AA-API-1"><span class="toc-number">1.20.</span> <span class="toc-text">2. 环境搭建与第一个 API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.20.1.</span> <span class="toc-text">2.1. 先决条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE-CLI-%E4%B8%8E-Visual-Studio"><span class="toc-number">1.20.2.</span> <span class="toc-text">2.2. 创建新项目 (CLI 与 Visual Studio)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-NET-CLI"><span class="toc-number">1.20.2.1.</span> <span class="toc-text">使用 .NET CLI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Visual-Studio"><span class="toc-number">1.20.2.2.</span> <span class="toc-text">使用 Visual Studio</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%A7%88-%E5%9F%BA%E4%BA%8E%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.20.3.</span> <span class="toc-text">2.3. 项目结构概览 (基于控制器的模板)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Program-cs-%E5%BA%94%E7%94%A8%E7%9A%84%E8%B5%B7%E7%82%B9"><span class="toc-number">1.20.4.</span> <span class="toc-text">2.4. Program.cs - 应用的起点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-API"><span class="toc-number">1.20.5.</span> <span class="toc-text">2.5. 运行与测试你的第一个 API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8E%A7%E5%88%B6%E5%99%A8-Controllers-vs-%E6%9C%80%E5%B0%8F-API-Minimal-APIs-1"><span class="toc-number">1.21.</span> <span class="toc-text">3. 控制器 (Controllers) vs. 最小 API (Minimal APIs)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9F%BA%E4%BA%8E%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84-API"><span class="toc-number">1.21.1.</span> <span class="toc-text">3.1. 基于控制器的 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9C%80%E5%B0%8F-API"><span class="toc-number">1.21.2.</span> <span class="toc-text">3.2. 最小 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9"><span class="toc-number">1.21.3.</span> <span class="toc-text">3.3. 如何选择?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1-Routing-1"><span class="toc-number">1.22.</span> <span class="toc-text">4. 路由 (Routing)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80"><span class="toc-number">1.22.1.</span> <span class="toc-text">4.1. 路由基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%9F%BA%E4%BA%8E%E5%B1%9E%E6%80%A7%E7%9A%84%E8%B7%AF%E7%94%B1-Controllers"><span class="toc-number">1.22.2.</span> <span class="toc-text">4.2. 基于属性的路由 (Controllers)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%B7%AF%E7%94%B1%E5%9C%A8%E6%9C%80%E5%B0%8F-API-%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.22.3.</span> <span class="toc-text">4.3. 路由在最小 API 中的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E4%B8%8E%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.22.4.</span> <span class="toc-text">4.4. 路由参数与约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E8%B7%AF%E7%94%B1%E5%91%BD%E5%90%8D%E4%B8%8E%E9%93%BE%E6%8E%A5%E7%94%9F%E6%88%90"><span class="toc-number">1.22.5.</span> <span class="toc-text">4.5. 路由命名与链接生成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-HTTP-%E5%8A%A8%E8%AF%8D%E4%B8%8E%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95-Actions-1"><span class="toc-number">1.23.</span> <span class="toc-text">5. HTTP 动词与操作方法 (Actions)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E7%90%86%E8%A7%A3-HTTP-%E5%8A%A8%E8%AF%8D-GET-POST-PUT-DELETE-PATCH-%E7%AD%89"><span class="toc-number">1.23.1.</span> <span class="toc-text">5.1. 理解 HTTP 动词 (GET, POST, PUT, DELETE, PATCH 等)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%AD%E6%98%A0%E5%B0%84%E5%8A%A8%E8%AF%8D"><span class="toc-number">1.23.2.</span> <span class="toc-text">5.2. 在控制器中映射动词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%9C%A8%E6%9C%80%E5%B0%8F-API-%E4%B8%AD%E6%98%A0%E5%B0%84%E5%8A%A8%E8%AF%8D"><span class="toc-number">1.23.3.</span> <span class="toc-text">5.3. 在最小 API 中映射动词</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%EF%BC%9A%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A%E3%80%81%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%93%8D%E5%BA%94-1"><span class="toc-number">1.24.</span> <span class="toc-text">6. 数据处理：模型绑定、验证与响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A-Model-Binding"><span class="toc-number">1.24.1.</span> <span class="toc-text">6.1. 模型绑定 (Model Binding)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E6%BA%90-FromRoute-FromQuery-FromBody-FromHeader-FromForm"><span class="toc-number">1.24.1.1.</span> <span class="toc-text">绑定源 ([FromRoute], [FromQuery], [FromBody], [FromHeader], [FromForm])</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81-Data-Validation"><span class="toc-number">1.24.2.</span> <span class="toc-text">6.2. 数据验证 (Data Validation)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B3%A8%E8%A7%A3-Data-Annotations"><span class="toc-number">1.24.2.1.</span> <span class="toc-text">数据注解 (Data Annotations)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FluentValidation-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-number">1.24.2.2.</span> <span class="toc-text">FluentValidation (第三方库)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ModelState-%E4%B8%8E%E8%87%AA%E5%8A%A8-HTTP-400-%E5%93%8D%E5%BA%94"><span class="toc-number">1.24.2.3.</span> <span class="toc-text">ModelState 与自动 HTTP 400 响应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E8%BF%94%E5%9B%9E%E5%93%8D%E5%BA%94-Responses"><span class="toc-number">1.24.3.</span> <span class="toc-text">6.3. 返回响应 (Responses)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.24.3.1.</span> <span class="toc-text">HTTP 状态码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IActionResult-%E4%B8%8E-ActionResult"><span class="toc-number">1.24.3.2.</span> <span class="toc-text">IActionResult 与 ActionResult&lt;T&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F-API-%E4%B8%AD%E7%9A%84-Results-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.24.3.3.</span> <span class="toc-text">最小 API 中的 Results 类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86-Content-Negotiation-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.24.4.</span> <span class="toc-text">6.4. 内容协商 (Content Negotiation - 简介)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%99%A8-Formatters"><span class="toc-number">1.24.5.</span> <span class="toc-text">6.5. 输入与输出格式化器 (Formatters)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-Dependency-Injection-DI-1"><span class="toc-number">1.25.</span> <span class="toc-text">7. 依赖注入 (Dependency Injection - DI)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-DI-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.25.1.</span> <span class="toc-text">7.1. DI 核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%9C%8D%E5%8A%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-Singleton-Scoped-Transient"><span class="toc-number">1.25.2.</span> <span class="toc-text">7.2. 服务生命周期 (Singleton, Scoped, Transient)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%B3%A8%E5%86%8C%E6%9C%8D%E5%8A%A1-Program-cs"><span class="toc-number">1.25.3.</span> <span class="toc-text">7.3. 注册服务 (Program.cs)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E6%B3%A8%E5%85%A5%E6%9C%8D%E5%8A%A1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">1.25.4.</span> <span class="toc-text">7.4. 注入服务 (构造函数注入, 操作方法注入)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E9%85%8D%E7%BD%AE-Configuration-1"><span class="toc-number">1.26.</span> <span class="toc-text">8. 配置 (Configuration)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-appsettings-json-%E4%B8%8E%E7%8E%AF%E5%A2%83%E7%89%B9%E5%AE%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">1.26.1.</span> <span class="toc-text">8.1. appsettings.json 与环境特定配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE-IConfiguration"><span class="toc-number">1.26.2.</span> <span class="toc-text">8.2. 读取配置数据 (IConfiguration)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E9%80%89%E9%A1%B9%E6%A8%A1%E5%BC%8F-Options-Pattern"><span class="toc-number">1.26.3.</span> <span class="toc-text">8.3. 选项模式 (Options Pattern)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E4%B8%AD%E9%97%B4%E4%BB%B6-Middleware-1"><span class="toc-number">1.27.</span> <span class="toc-text">9. 中间件 (Middleware)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.27.1.</span> <span class="toc-text">9.1. 什么是中间件?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E7%AE%A1%E9%81%93-Request-Pipeline"><span class="toc-number">1.27.2.</span> <span class="toc-text">9.2. 请求处理管道 (Request Pipeline)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%86%85%E7%BD%AE%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.27.3.</span> <span class="toc-text">9.3. 内置中间件示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.27.4.</span> <span class="toc-text">9.4. 编写自定义中间件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95-1"><span class="toc-number">1.28.</span> <span class="toc-text">10. 错误处理与日志记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%BC%82%E5%B8%B8%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.28.1.</span> <span class="toc-text">10.1. 开发环境异常页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6-UseExceptionHandler"><span class="toc-number">1.28.2.</span> <span class="toc-text">10.2. 生产环境异常处理中间件 (UseExceptionHandler)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-ProblemDetails-%E8%A7%84%E8%8C%83"><span class="toc-number">1.28.3.</span> <span class="toc-text">10.3. ProblemDetails 规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95-ILogger"><span class="toc-number">1.28.4.</span> <span class="toc-text">10.4. 日志记录 (ILogger)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%AE%89%E5%85%A8%E6%80%A7-Security-1"><span class="toc-number">1.29.</span> <span class="toc-text">11. 安全性 (Security)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-HTTPS"><span class="toc-number">1.29.1.</span> <span class="toc-text">11.1. HTTPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E8%AE%A4%E8%AF%81-Authentication"><span class="toc-number">1.29.2.</span> <span class="toc-text">11.2. 认证 (Authentication)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JWT-JSON-Web-Tokens"><span class="toc-number">1.29.2.1.</span> <span class="toc-text">JWT (JSON Web Tokens)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cookie-%E8%AE%A4%E8%AF%81-%E9%80%82%E7%94%A8%E4%BA%8E-Web-%E5%BA%94%E7%94%A8%EF%BC%8CAPI-%E4%B8%AD%E8%BE%83%E5%B0%91"><span class="toc-number">1.29.2.2.</span> <span class="toc-text">Cookie 认证 (适用于 Web 应用，API 中较少)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-3-ASP-NET-Core-Identity"><span class="toc-number">1.29.2.3.</span> <span class="toc-text">11.2.3 ASP.NET Core Identity</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-%E6%8E%88%E6%9D%83-Authorization"><span class="toc-number">1.29.3.</span> <span class="toc-text">11.3. 授权 (Authorization)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Authorize-%E7%89%B9%E6%80%A7"><span class="toc-number">1.29.3.1.</span> <span class="toc-text">[Authorize] 特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E6%8E%88%E6%9D%83-Role-based"><span class="toc-number">1.29.3.2.</span> <span class="toc-text">基于角色的授权 (Role-based)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%AD%96%E7%95%A5%E7%9A%84%E6%8E%88%E6%9D%83-Policy-based"><span class="toc-number">1.29.3.3.</span> <span class="toc-text">基于策略的授权 (Policy-based)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-CORS-Cross-Origin-Resource-Sharing"><span class="toc-number">1.29.4.</span> <span class="toc-text">11.4. CORS (Cross-Origin Resource Sharing)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-5-%E9%98%B2%E6%AD%A2%E5%B8%B8%E8%A7%81-Web-%E6%BC%8F%E6%B4%9E-XSS-CSRF-API-%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="toc-number">1.29.5.</span> <span class="toc-text">11.5. 防止常见 Web 漏洞 (XSS, CSRF - API 相关性)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-6-API-%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86"><span class="toc-number">1.29.6.</span> <span class="toc-text">11.6. API 密钥管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-API-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6-Versioning-1"><span class="toc-number">1.30.</span> <span class="toc-text">12. API 版本控制 (Versioning)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-API-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.30.1.</span> <span class="toc-text">12.1. 为什么需要 API 版本控制?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E5%B8%B8%E8%A7%81%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5"><span class="toc-number">1.30.2.</span> <span class="toc-text">12.2. 常见版本控制策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E4%BD%BF%E7%94%A8-Asp-Versioning-%E5%BA%93"><span class="toc-number">1.30.3.</span> <span class="toc-text">12.3. 使用 Asp.Versioning 库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-API-%E6%96%87%E6%A1%A3-Swagger-OpenAPI-1"><span class="toc-number">1.31.</span> <span class="toc-text">13. API 文档 (Swagger&#x2F;OpenAPI)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-OpenAPI-%E8%A7%84%E8%8C%83"><span class="toc-number">1.31.1.</span> <span class="toc-text">13.1. OpenAPI 规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E4%BD%BF%E7%94%A8-Swashbuckle-AspNetCore"><span class="toc-number">1.31.2.</span> <span class="toc-text">13.2. 使用 Swashbuckle.AspNetCore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-%E4%BD%BF%E7%94%A8-NSwag-%E5%A4%87%E9%80%89%E6%96%B9%E6%A1%88"><span class="toc-number">1.31.3.</span> <span class="toc-text">13.3. 使用 NSwag (备选方案)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E6%B5%8B%E8%AF%95-Web-API-1"><span class="toc-number">1.32.</span> <span class="toc-text">14. 测试 Web API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.32.1.</span> <span class="toc-text">14.1. 单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95-WebApplicationFactory"><span class="toc-number">1.32.2.</span> <span class="toc-text">14.2. 集成测试 (WebApplicationFactory)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98-1"><span class="toc-number">1.33.</span> <span class="toc-text">15. 高级主题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-%E8%BF%87%E6%BB%A4%E5%99%A8-Filters"><span class="toc-number">1.33.1.</span> <span class="toc-text">15.1. 过滤器 (Filters)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6-Rate-Limiting"><span class="toc-number">1.33.2.</span> <span class="toc-text">15.2. 速率限制 (Rate Limiting)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-3-%E7%BC%93%E5%AD%98-Caching"><span class="toc-number">1.33.3.</span> <span class="toc-text">15.3. 缓存 (Caching)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-4-%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E4%B8%8E%E6%89%98%E7%AE%A1%E6%9C%8D%E5%8A%A1-IHostedService"><span class="toc-number">1.33.4.</span> <span class="toc-text">15.4. 后台任务与托管服务 (IHostedService)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-5-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5-Health-Checks"><span class="toc-number">1.33.5.</span> <span class="toc-text">15.5. 健康检查 (Health Checks)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-6-gRPC-%E4%BD%9C%E4%B8%BA-REST-API-%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%88%96%E8%A1%A5%E5%85%85"><span class="toc-number">1.33.6.</span> <span class="toc-text">15.6. gRPC (作为 REST API 的替代或补充)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E9%83%A8%E7%BD%B2-ASP-NET-Core-Web-API-1"><span class="toc-number">1.34.</span> <span class="toc-text">16. 部署 ASP.NET Core Web API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#16-1-%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8"><span class="toc-number">1.34.1.</span> <span class="toc-text">16.1. 发布应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-2-%E6%89%98%E7%AE%A1%E6%A8%A1%E5%9E%8B-%E8%BF%9B%E7%A8%8B%E5%86%85-vs-%E8%BF%9B%E7%A8%8B%E5%A4%96-%E4%B8%BB%E8%A6%81%E9%92%88%E5%AF%B9-IIS"><span class="toc-number">1.34.2.</span> <span class="toc-text">16.2. 托管模型 (进程内 vs. 进程外 - 主要针对 IIS)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-3-%E5%B8%B8%E8%A7%81%E6%89%98%E7%AE%A1%E7%8E%AF%E5%A2%83-IIS-Kestrel-Nginx-Apache-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-Docker-Azure-App-Service-AWS-%E7%AD%89"><span class="toc-number">1.34.3.</span> <span class="toc-text">16.3. 常见托管环境 (IIS, Kestrel, Nginx&#x2F;Apache 反向代理, Docker, Azure App Service, AWS 等)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-1"><span class="toc-number">1.35.</span> <span class="toc-text">17. 最佳实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B-1"><span class="toc-number">1.36.</span> <span class="toc-text">18. 总结与未来展望</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/12/%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2/" title="模型部署">模型部署</a><time datetime="2025-05-11T18:17:36.000Z" title="发表于 2025-05-12 02:17:36">2025-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/12/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="数据科学与机器学习">数据科学与机器学习</a><time datetime="2025-05-11T18:17:28.000Z" title="发表于 2025-05-12 02:17:28">2025-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/12/pytorch%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="pytorch基础知识">pytorch基础知识</a><time datetime="2025-05-11T18:17:15.000Z" title="发表于 2025-05-12 02:17:15">2025-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/12/python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="python基础知识">python基础知识</a><time datetime="2025-05-11T18:16:59.000Z" title="发表于 2025-05-12 02:16:59">2025-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/12/ASP-NET-WEB-API/" title="ASP.NET WEB API">ASP.NET WEB API</a><time datetime="2025-05-11T18:16:40.000Z" title="发表于 2025-05-12 02:16:40">2025-05-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="Jackey Zhou" target="_blank">Jackey Zhou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CSharp%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">CSharp学习<sup>3</sup></a><a href="/tags/IDE%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 0.88rem;">IDE常用快捷键<sup>2</sup></a><a href="/tags/Rust%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">Rust基础知识<sup>21</sup></a><a href="/tags/csharp%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">csharp相关学习<sup>5</sup></a><a href="/tags/docker%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">docker学习<sup>1</sup></a><a href="/tags/hexo%E5%8D%9A%E5%AE%A2%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4/" style="font-size: 0.88rem;">hexo博客常见命令<sup>1</sup></a><a href="/tags/python%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">python相关学习<sup>4</sup></a><a href="/tags/xmake%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">xmake学习<sup>3</sup></a><a href="/tags/%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">个人学习<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" style="font-size: 0.88rem;">数据分析<sup>1</sup></a><a href="/tags/%E6%97%A0%E7%BA%BF%E8%B0%83%E8%AF%95/" style="font-size: 0.88rem;">无线调试<sup>1</sup></a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">深度学习<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" style="font-size: 0.88rem;">系统常用命令<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 0.88rem;">系统常用快捷键<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Jackey Zhou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>